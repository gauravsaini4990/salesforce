import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import "core-js/modules/es.number.constructor";
import "core-js/modules/es.object.to-string";
import "core-js/modules/es.promise";
import _concatInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/concat";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import _reduceInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/reduce";
import _Promise from "@babel/runtime-corejs3/core-js-stable/promise";
import _indexOfInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/index-of";
import _regeneratorRuntime from "@babel/runtime-corejs3/regenerator";
import "regenerator-runtime/runtime";
import _asyncToGenerator from "@babel/runtime-corejs3/helpers/asyncToGenerator";
import _classCallCheck from "@babel/runtime-corejs3/helpers/classCallCheck";
import _createClass from "@babel/runtime-corejs3/helpers/createClass";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";

function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context19; _forEachInstanceProperty(_context19 = ownKeys(Object(source), true)).call(_context19, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context20; _forEachInstanceProperty(_context20 = ownKeys(Object(source))).call(_context20, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }

/**
 * @file Command line interface for JSforce
 * @author Shinichi Tomita <shinichi.tomita@gmail.com>
 */
import http from 'http';
import url from 'url';
import crypto from 'crypto';
import _openUrl from 'open';
import { Command } from 'commander';
import inquirer from 'inquirer';
import request from '../request';
import base64url from 'base64url';
import Repl from './repl';
import jsforce, { Connection, OAuth2 } from '..';
import version from '../VERSION';
var registry = jsforce.registry;

/**
 *
 */
export var Cli = /*#__PURE__*/function () {
  function Cli() {
    _classCallCheck(this, Cli);

    _defineProperty(this, "_repl", new Repl(this));

    _defineProperty(this, "_conn", new Connection());

    _defineProperty(this, "_connName", undefined);

    _defineProperty(this, "_outputEnabled", true);

    _defineProperty(this, "_defaultLoginUrl", undefined);
  }

  _createClass(Cli, [{
    key: "readCommand",

    /**
     *
     */
    value: function readCommand() {
      return new Command().option('-u, --username [username]', 'Salesforce username').option('-p, --password [password]', 'Salesforce password (and security token, if available)').option('-c, --connection [connection]', 'Connection name stored in connection registry').option('-l, --loginUrl [loginUrl]', 'Salesforce login url').option('--sandbox', 'Login to Salesforce sandbox').option('-e, --evalScript [evalScript]', 'Script to evaluate').version(version).parse(process.argv);
    }
  }, {
    key: "start",
    value: function () {
      var _start = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {
        var program;
        return _regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                program = this.readCommand();
                this._outputEnabled = !program.evalScript;
                _context.prev = 2;
                _context.next = 5;
                return this.connect(program);

              case 5:
                if (program.evalScript) {
                  this._repl.start({
                    interactive: false,
                    evalScript: program.evalScript
                  });
                } else {
                  this._repl.start();
                }

                _context.next = 12;
                break;

              case 8:
                _context.prev = 8;
                _context.t0 = _context["catch"](2);
                console.error(_context.t0);
                process.exit();

              case 12:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 8]]);
      }));

      function start() {
        return _start.apply(this, arguments);
      }

      return start;
    }()
  }, {
    key: "getCurrentConnection",
    value: function getCurrentConnection() {
      return this._conn;
    }
  }, {
    key: "print",
    value: function print() {
      if (this._outputEnabled) {
        var _console;

        (_console = console).log.apply(_console, arguments);
      }
    }
  }, {
    key: "saveCurrentConnection",
    value: function saveCurrentConnection() {
      if (this._connName) {
        var conn = this._conn;
        var connName = this._connName;
        var connConfig = {
          oauth2: conn.oauth2 ? {
            clientId: conn.oauth2.clientId || undefined,
            clientSecret: conn.oauth2.clientSecret || undefined,
            redirectUri: conn.oauth2.redirectUri || undefined,
            loginUrl: conn.oauth2.loginUrl || undefined
          } : undefined,
          accessToken: conn.accessToken || undefined,
          instanceUrl: conn.instanceUrl || undefined,
          refreshToken: conn.refreshToken || undefined
        };
        registry.saveConnectionConfig(connName, connConfig);
      }
    }
  }, {
    key: "setLoginServer",
    value: function setLoginServer(loginServer) {
      if (!loginServer) {
        return;
      }

      if (loginServer === 'production') {
        this._defaultLoginUrl = 'https://login.salesforce.com';
      } else if (loginServer === 'sandbox') {
        this._defaultLoginUrl = 'https://test.salesforce.com';
      } else if (_indexOfInstanceProperty(loginServer).call(loginServer, 'https://') !== 0) {
        this._defaultLoginUrl = 'https://' + loginServer;
      } else {
        this._defaultLoginUrl = loginServer;
      }

      this.print("Using \"".concat(this._defaultLoginUrl, "\" as default login URL."));
    }
    /**
     *
     */

  }, {
    key: "connect",
    value: function () {
      var _connect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(options) {
        var _this = this;

        var loginServer, connConfig, username, password, identity;
        return _regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                loginServer = options.loginUrl ? options.loginUrl : options.sandbox ? 'sandbox' : null;
                this.setLoginServer(loginServer);
                this._connName = options.connection;
                _context2.next = 5;
                return registry.getConnectionConfig(options.connection);

              case 5:
                connConfig = _context2.sent;
                username = options.username;

                if (!connConfig) {
                  connConfig = {};

                  if (this._defaultLoginUrl) {
                    connConfig.loginUrl = this._defaultLoginUrl;
                  }

                  username = username || options.connection;
                }

                this._conn = new Connection(connConfig);
                password = options.password;

                if (!username) {
                  _context2.next = 16;
                  break;
                }

                _context2.next = 13;
                return this.startPasswordAuth(username, password);

              case 13:
                this.saveCurrentConnection();
                _context2.next = 34;
                break;

              case 16:
                if (!(this._connName && this._conn.accessToken)) {
                  _context2.next = 34;
                  break;
                }

                this._conn.on('refresh', function () {
                  _this.print('Refreshing access token ... ');

                  _this.saveCurrentConnection();
                });

                _context2.prev = 18;
                _context2.next = 21;
                return this._conn.identity();

              case 21:
                identity = _context2.sent;
                this.print("Logged in as : ".concat(identity.username));
                _context2.next = 34;
                break;

              case 25:
                _context2.prev = 25;
                _context2.t0 = _context2["catch"](18);
                this.print(_context2.t0.message);

                if (!this._conn.oauth2) {
                  _context2.next = 32;
                  break;
                }

                throw new Error('Please re-authorize connection.');

              case 32:
                _context2.next = 34;
                return this.startPasswordAuth(this._connName);

              case 34:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this, [[18, 25]]);
      }));

      function connect(_x) {
        return _connect.apply(this, arguments);
      }

      return connect;
    }()
    /**
     *
     */

  }, {
    key: "startPasswordAuth",
    value: function () {
      var _startPasswordAuth = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(username, password) {
        return _regeneratorRuntime.wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.prev = 0;
                _context3.next = 3;
                return this.loginByPassword(username, password, 2);

              case 3:
                _context3.next = 12;
                break;

              case 5:
                _context3.prev = 5;
                _context3.t0 = _context3["catch"](0);

                if (!(_context3.t0.message === 'canceled')) {
                  _context3.next = 11;
                  break;
                }

                console.error('Password authentication canceled: Not logged in');
                _context3.next = 12;
                break;

              case 11:
                throw _context3.t0;

              case 12:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this, [[0, 5]]);
      }));

      function startPasswordAuth(_x2, _x3) {
        return _startPasswordAuth.apply(this, arguments);
      }

      return startPasswordAuth;
    }()
    /**
     *
     */

  }, {
    key: "loginByPassword",
    value: function () {
      var _loginByPassword = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(username, password, retryCount) {
        var pass, result;
        return _regeneratorRuntime.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                if (!(password === '')) {
                  _context4.next = 2;
                  break;
                }

                throw new Error('canceled');

              case 2:
                if (!(password == null)) {
                  _context4.next = 7;
                  break;
                }

                _context4.next = 5;
                return this.promptPassword('Password: ');

              case 5:
                pass = _context4.sent;
                return _context4.abrupt("return", this.loginByPassword(username, pass, retryCount));

              case 7:
                _context4.prev = 7;
                _context4.next = 10;
                return this._conn.login(username, password);

              case 10:
                result = _context4.sent;
                this.print("Logged in as : ".concat(username));
                return _context4.abrupt("return", result);

              case 15:
                _context4.prev = 15;
                _context4.t0 = _context4["catch"](7);
                console.error(_context4.t0.message);

                if (!(retryCount > 0)) {
                  _context4.next = 22;
                  break;
                }

                return _context4.abrupt("return", this.loginByPassword(username, undefined, retryCount - 1));

              case 22:
                throw new Error('canceled');

              case 23:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this, [[7, 15]]);
      }));

      function loginByPassword(_x4, _x5, _x6) {
        return _loginByPassword.apply(this, arguments);
      }

      return loginByPassword;
    }()
    /**
     *
     */

  }, {
    key: "disconnect",
    value: function disconnect(connName) {
      var name = connName || this._connName;

      if (name && registry.getConnectionConfig(name)) {
        registry.removeConnectionConfig(name);
        this.print("Disconnect connection '".concat(name, "'"));
      }

      this._connName = undefined;
      this._conn = new Connection();
    }
    /**
     *
     */

  }, {
    key: "authorize",
    value: function () {
      var _authorize = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(clientName) {
        var name, oauth2Config, oauth2, verifier, challenge, state, authzUrl, params, identity;
        return _regeneratorRuntime.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                name = clientName || 'default';
                _context5.next = 3;
                return registry.getClientConfig(name);

              case 3:
                oauth2Config = _context5.sent;

                if (!(!oauth2Config || !oauth2Config.clientId)) {
                  _context5.next = 9;
                  break;
                }

                if (!(name === 'default' || name === 'sandbox')) {
                  _context5.next = 8;
                  break;
                }

                this.print('No client information registered. Downloading JSforce default client information...');
                return _context5.abrupt("return", this.downloadDefaultClientInfo(name));

              case 8:
                throw new Error("No OAuth2 client information registered : '".concat(name, "'. Please register client info first."));

              case 9:
                oauth2 = new OAuth2(oauth2Config);
                verifier = base64url.encode(crypto.randomBytes(32));
                challenge = base64url.encode(crypto.createHash('sha256').update(verifier).digest());
                state = base64url.encode(crypto.randomBytes(32));
                authzUrl = oauth2.getAuthorizationUrl({
                  code_challenge: challenge,
                  state: state
                });
                this.print('Opening authorization page in browser...');
                this.print("URL: ".concat(authzUrl));
                this.openUrl(authzUrl);
                _context5.next = 19;
                return this.waitCallback(oauth2Config.redirectUri, state);

              case 19:
                params = _context5.sent;

                if (params.code) {
                  _context5.next = 22;
                  break;
                }

                throw new Error('No authorization code returned.');

              case 22:
                if (!(params.state !== state)) {
                  _context5.next = 24;
                  break;
                }

                throw new Error('Invalid state parameter returned.');

              case 24:
                this._conn = new Connection({
                  oauth2: oauth2
                });
                this.print('Received authorization code. Please close the opened browser window.');
                _context5.next = 28;
                return this._conn.authorize(params.code, {
                  code_verifier: verifier
                });

              case 28:
                this.print('Authorized. Fetching user info...');
                _context5.next = 31;
                return this._conn.identity();

              case 31:
                identity = _context5.sent;
                this.print("Logged in as : ".concat(identity.username));
                this._connName = identity.username;
                this.saveCurrentConnection();

              case 35:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function authorize(_x7) {
        return _authorize.apply(this, arguments);
      }

      return authorize;
    }()
    /**
     *
     */

  }, {
    key: "downloadDefaultClientInfo",
    value: function () {
      var _downloadDefaultClientInfo = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(clientName) {
        var configUrl, res, clientConfig;
        return _regeneratorRuntime.wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                configUrl = 'https://jsforce.github.io/client-config/default.json';
                _context6.next = 3;
                return new _Promise(function (resolve, reject) {
                  request({
                    method: 'GET',
                    url: configUrl
                  }).on('complete', resolve).on('error', reject);
                });

              case 3:
                res = _context6.sent;
                clientConfig = JSON.parse(res.body);

                if (clientName === 'sandbox') {
                  clientConfig.loginUrl = 'https://test.salesforce.com';
                }

                _context6.next = 8;
                return registry.registerClientConfig(clientName, clientConfig);

              case 8:
                this.print('Client information downloaded successfully.');
                return _context6.abrupt("return", this.authorize(clientName));

              case 10:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function downloadDefaultClientInfo(_x8) {
        return _downloadDefaultClientInfo.apply(this, arguments);
      }

      return downloadDefaultClientInfo;
    }()
  }, {
    key: "waitCallback",
    value: function () {
      var _waitCallback = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(serverUrl, state) {
        var code;
        return _regeneratorRuntime.wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                if (!(serverUrl && _indexOfInstanceProperty(serverUrl).call(serverUrl, 'http://localhost:') === 0)) {
                  _context7.next = 4;
                  break;
                }

                return _context7.abrupt("return", new _Promise(function (resolve, reject) {
                  var server = http.createServer(function (req, res) {
                    if (!req.url) {
                      return;
                    }

                    var qparams = url.parse(req.url, true).query;
                    res.writeHead(200, {
                      'Content-Type': 'text/html'
                    });
                    res.write('<html><script>location.href="about:blank";</script></html>');
                    res.end();

                    if (qparams.error) {
                      reject(new Error(qparams.error));
                    } else {
                      resolve(qparams);
                    }

                    server.close();
                    req.connection.end();
                    req.connection.destroy();
                  });
                  var port = Number(url.parse(serverUrl).port);
                  server.listen(port, 'localhost');
                }));

              case 4:
                _context7.next = 6;
                return this.promptMessage('Copy & paste authz code passed in redirected URL: ');

              case 6:
                code = _context7.sent;
                return _context7.abrupt("return", {
                  code: decodeURIComponent(code),
                  state: state
                });

              case 8:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function waitCallback(_x9, _x10) {
        return _waitCallback.apply(this, arguments);
      }

      return waitCallback;
    }()
    /**
     *
     */

  }, {
    key: "register",
    value: function () {
      var _register = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(clientName, clientConfig) {
        var _context8,
            _this2 = this;

        var name, prompts, registered, msg, ok;
        return _regeneratorRuntime.wrap(function _callee9$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                name = clientName || 'default';
                prompts = {
                  clientId: 'Input client ID : ',
                  clientSecret: 'Input client secret (optional) : ',
                  redirectUri: 'Input redirect URI : ',
                  loginUrl: 'Input login URL (default is https://login.salesforce.com) : '
                };
                _context10.next = 4;
                return registry.getClientConfig(name);

              case 4:
                registered = _context10.sent;

                if (!registered) {
                  _context10.next = 12;
                  break;
                }

                msg = "Client '".concat(name, "' is already registered. Are you sure you want to override ? [yN] : ");
                _context10.next = 9;
                return this.promptConfirm(msg);

              case 9:
                ok = _context10.sent;

                if (ok) {
                  _context10.next = 12;
                  break;
                }

                throw new Error('Registration canceled.');

              case 12:
                _context10.next = 14;
                return _reduceInstanceProperty(_context8 = _Object$keys(prompts)).call(_context8, /*#__PURE__*/function () {
                  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(promise, name) {
                    var cconfig, promptName, message, value;
                    return _regeneratorRuntime.wrap(function _callee8$(_context9) {
                      while (1) {
                        switch (_context9.prev = _context9.next) {
                          case 0:
                            _context9.next = 2;
                            return promise;

                          case 2:
                            cconfig = _context9.sent;
                            promptName = name;
                            message = prompts[promptName];

                            if (cconfig[promptName]) {
                              _context9.next = 11;
                              break;
                            }

                            _context9.next = 8;
                            return _this2.promptMessage(message);

                          case 8:
                            value = _context9.sent;

                            if (!value) {
                              _context9.next = 11;
                              break;
                            }

                            return _context9.abrupt("return", _objectSpread(_objectSpread({}, cconfig), {}, _defineProperty({}, promptName, value)));

                          case 11:
                            return _context9.abrupt("return", cconfig);

                          case 12:
                          case "end":
                            return _context9.stop();
                        }
                      }
                    }, _callee8);
                  }));

                  return function (_x13, _x14) {
                    return _ref.apply(this, arguments);
                  };
                }(), _Promise.resolve(clientConfig));

              case 14:
                clientConfig = _context10.sent;
                _context10.next = 17;
                return registry.registerClientConfig(name, clientConfig);

              case 17:
                this.print('Client registered successfully.');

              case 18:
              case "end":
                return _context10.stop();
            }
          }
        }, _callee9, this);
      }));

      function register(_x11, _x12) {
        return _register.apply(this, arguments);
      }

      return register;
    }()
    /**
     *
     */

  }, {
    key: "listConnections",
    value: function () {
      var _listConnections = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10() {
        var names, i, name;
        return _regeneratorRuntime.wrap(function _callee10$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                _context11.next = 2;
                return registry.getConnectionNames();

              case 2:
                names = _context11.sent;

                for (i = 0; i < names.length; i++) {
                  name = names[i];
                  this.print((name === this._connName ? '* ' : '  ') + name);
                }

              case 4:
              case "end":
                return _context11.stop();
            }
          }
        }, _callee10, this);
      }));

      function listConnections() {
        return _listConnections.apply(this, arguments);
      }

      return listConnections;
    }()
    /**
     *
     */

  }, {
    key: "getConnectionNames",
    value: function () {
      var _getConnectionNames = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee11() {
        return _regeneratorRuntime.wrap(function _callee11$(_context12) {
          while (1) {
            switch (_context12.prev = _context12.next) {
              case 0:
                return _context12.abrupt("return", registry.getConnectionNames());

              case 1:
              case "end":
                return _context12.stop();
            }
          }
        }, _callee11);
      }));

      function getConnectionNames() {
        return _getConnectionNames.apply(this, arguments);
      }

      return getConnectionNames;
    }()
    /**
     *
     */

  }, {
    key: "getClientNames",
    value: function () {
      var _getClientNames = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee12() {
        return _regeneratorRuntime.wrap(function _callee12$(_context13) {
          while (1) {
            switch (_context13.prev = _context13.next) {
              case 0:
                return _context13.abrupt("return", registry.getClientNames());

              case 1:
              case "end":
                return _context13.stop();
            }
          }
        }, _callee12);
      }));

      function getClientNames() {
        return _getClientNames.apply(this, arguments);
      }

      return getClientNames;
    }()
    /**
     *
     */

  }, {
    key: "prompt",
    value: function () {
      var _prompt = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee13(type, message) {
        var answer;
        return _regeneratorRuntime.wrap(function _callee13$(_context14) {
          while (1) {
            switch (_context14.prev = _context14.next) {
              case 0:
                this._repl.pause();

                _context14.next = 3;
                return inquirer.prompt([{
                  type: type,
                  name: 'value',
                  message: message
                }]);

              case 3:
                answer = _context14.sent;

                this._repl.resume();

                return _context14.abrupt("return", answer.value);

              case 6:
              case "end":
                return _context14.stop();
            }
          }
        }, _callee13, this);
      }));

      function prompt(_x15, _x16) {
        return _prompt.apply(this, arguments);
      }

      return prompt;
    }()
    /**
     *
     */

  }, {
    key: "promptMessage",
    value: function () {
      var _promptMessage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee14(message) {
        return _regeneratorRuntime.wrap(function _callee14$(_context15) {
          while (1) {
            switch (_context15.prev = _context15.next) {
              case 0:
                return _context15.abrupt("return", this.prompt('input', message));

              case 1:
              case "end":
                return _context15.stop();
            }
          }
        }, _callee14, this);
      }));

      function promptMessage(_x17) {
        return _promptMessage.apply(this, arguments);
      }

      return promptMessage;
    }()
  }, {
    key: "promptPassword",
    value: function () {
      var _promptPassword = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee15(message) {
        return _regeneratorRuntime.wrap(function _callee15$(_context16) {
          while (1) {
            switch (_context16.prev = _context16.next) {
              case 0:
                return _context16.abrupt("return", this.prompt('password', message));

              case 1:
              case "end":
                return _context16.stop();
            }
          }
        }, _callee15, this);
      }));

      function promptPassword(_x18) {
        return _promptPassword.apply(this, arguments);
      }

      return promptPassword;
    }()
    /**
     *
     */

  }, {
    key: "promptConfirm",
    value: function () {
      var _promptConfirm = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee16(message) {
        return _regeneratorRuntime.wrap(function _callee16$(_context17) {
          while (1) {
            switch (_context17.prev = _context17.next) {
              case 0:
                return _context17.abrupt("return", this.prompt('confirm', message));

              case 1:
              case "end":
                return _context17.stop();
            }
          }
        }, _callee16, this);
      }));

      function promptConfirm(_x19) {
        return _promptConfirm.apply(this, arguments);
      }

      return promptConfirm;
    }()
    /**
     *
     */

  }, {
    key: "openUrl",
    value: function openUrl(url) {
      _openUrl(url);
    }
    /**
     *
     */

  }, {
    key: "openUrlUsingSession",
    value: function openUrlUsingSession(url) {
      var _context18;

      var frontdoorUrl = _concatInstanceProperty(_context18 = "".concat(this._conn.instanceUrl, "/secur/frontdoor.jsp?sid=")).call(_context18, this._conn.accessToken);

      if (url) {
        frontdoorUrl += '&retURL=' + encodeURIComponent(url);
      }

      this.openUrl(frontdoorUrl);
    }
  }]);

  return Cli;
}();
/* ------------------------------------------------------------------------- */

var cli = new Cli();
export default cli;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGkvY2xpLnRzIl0sIm5hbWVzIjpbImh0dHAiLCJ1cmwiLCJjcnlwdG8iLCJvcGVuVXJsIiwiQ29tbWFuZCIsImlucXVpcmVyIiwicmVxdWVzdCIsImJhc2U2NHVybCIsIlJlcGwiLCJqc2ZvcmNlIiwiQ29ubmVjdGlvbiIsIk9BdXRoMiIsInZlcnNpb24iLCJyZWdpc3RyeSIsIkNsaSIsInVuZGVmaW5lZCIsIm9wdGlvbiIsInBhcnNlIiwicHJvY2VzcyIsImFyZ3YiLCJwcm9ncmFtIiwicmVhZENvbW1hbmQiLCJfb3V0cHV0RW5hYmxlZCIsImV2YWxTY3JpcHQiLCJjb25uZWN0IiwiX3JlcGwiLCJzdGFydCIsImludGVyYWN0aXZlIiwiY29uc29sZSIsImVycm9yIiwiZXhpdCIsIl9jb25uIiwibG9nIiwiX2Nvbm5OYW1lIiwiY29ubiIsImNvbm5OYW1lIiwiY29ubkNvbmZpZyIsIm9hdXRoMiIsImNsaWVudElkIiwiY2xpZW50U2VjcmV0IiwicmVkaXJlY3RVcmkiLCJsb2dpblVybCIsImFjY2Vzc1Rva2VuIiwiaW5zdGFuY2VVcmwiLCJyZWZyZXNoVG9rZW4iLCJzYXZlQ29ubmVjdGlvbkNvbmZpZyIsImxvZ2luU2VydmVyIiwiX2RlZmF1bHRMb2dpblVybCIsInByaW50Iiwib3B0aW9ucyIsInNhbmRib3giLCJzZXRMb2dpblNlcnZlciIsImNvbm5lY3Rpb24iLCJnZXRDb25uZWN0aW9uQ29uZmlnIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInN0YXJ0UGFzc3dvcmRBdXRoIiwic2F2ZUN1cnJlbnRDb25uZWN0aW9uIiwib24iLCJpZGVudGl0eSIsIm1lc3NhZ2UiLCJFcnJvciIsImxvZ2luQnlQYXNzd29yZCIsInJldHJ5Q291bnQiLCJwcm9tcHRQYXNzd29yZCIsInBhc3MiLCJsb2dpbiIsInJlc3VsdCIsIm5hbWUiLCJyZW1vdmVDb25uZWN0aW9uQ29uZmlnIiwiY2xpZW50TmFtZSIsImdldENsaWVudENvbmZpZyIsIm9hdXRoMkNvbmZpZyIsImRvd25sb2FkRGVmYXVsdENsaWVudEluZm8iLCJ2ZXJpZmllciIsImVuY29kZSIsInJhbmRvbUJ5dGVzIiwiY2hhbGxlbmdlIiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsImRpZ2VzdCIsInN0YXRlIiwiYXV0aHpVcmwiLCJnZXRBdXRob3JpemF0aW9uVXJsIiwiY29kZV9jaGFsbGVuZ2UiLCJ3YWl0Q2FsbGJhY2siLCJwYXJhbXMiLCJjb2RlIiwiYXV0aG9yaXplIiwiY29kZV92ZXJpZmllciIsImNvbmZpZ1VybCIsInJlc29sdmUiLCJyZWplY3QiLCJtZXRob2QiLCJyZXMiLCJjbGllbnRDb25maWciLCJKU09OIiwiYm9keSIsInJlZ2lzdGVyQ2xpZW50Q29uZmlnIiwic2VydmVyVXJsIiwic2VydmVyIiwiY3JlYXRlU2VydmVyIiwicmVxIiwicXBhcmFtcyIsInF1ZXJ5Iiwid3JpdGVIZWFkIiwid3JpdGUiLCJlbmQiLCJjbG9zZSIsImRlc3Ryb3kiLCJwb3J0IiwiTnVtYmVyIiwibGlzdGVuIiwicHJvbXB0TWVzc2FnZSIsImRlY29kZVVSSUNvbXBvbmVudCIsInByb21wdHMiLCJyZWdpc3RlcmVkIiwibXNnIiwicHJvbXB0Q29uZmlybSIsIm9rIiwicHJvbWlzZSIsImNjb25maWciLCJwcm9tcHROYW1lIiwidmFsdWUiLCJnZXRDb25uZWN0aW9uTmFtZXMiLCJuYW1lcyIsImkiLCJsZW5ndGgiLCJnZXRDbGllbnROYW1lcyIsInR5cGUiLCJwYXVzZSIsInByb21wdCIsImFuc3dlciIsInJlc3VtZSIsImZyb250ZG9vclVybCIsImVuY29kZVVSSUNvbXBvbmVudCIsImNsaSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU9BLElBQVAsTUFBaUIsTUFBakI7QUFDQSxPQUFPQyxHQUFQLE1BQWdCLEtBQWhCO0FBQ0EsT0FBT0MsTUFBUCxNQUFtQixRQUFuQjtBQUNBLE9BQU9DLFFBQVAsTUFBb0IsTUFBcEI7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QTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBb1pFO0FBQ0Y7QUFDQTs7QUF0WkE7QUFBQTtBQUFBLDRCQXVaVTNELEdBdlpWLEVBdVp1QjtBQUNuQkUsTUFBQUEsUUFBTyxDQUFDRixHQUFELENBQVA7QUFDRDtBQUVEO0FBQ0Y7QUFDQTs7QUE3WkE7QUFBQTtBQUFBLHdDQThac0JBLEdBOVp0QixFQThab0M7QUFBQTs7QUFDaEMsVUFBSXFJLFlBQVksa0RBQU0sS0FBS3ZHLEtBQUwsQ0FBV1ksV0FBakIsaURBQXdELEtBQUtaLEtBQUwsQ0FBV1csV0FBbkUsQ0FBaEI7O0FBQ0EsVUFBSXpDLEdBQUosRUFBUztBQUNQcUksUUFBQUEsWUFBWSxJQUFJLGFBQWFDLGtCQUFrQixDQUFDdEksR0FBRCxDQUEvQztBQUNEOztBQUNELFdBQUtFLE9BQUwsQ0FBYW1JLFlBQWI7QUFDRDtBQXBhSDs7QUFBQTtBQUFBO0FBdWFBOztBQUVBLElBQU1FLEdBQUcsR0FBRyxJQUFJMUgsR0FBSixFQUFaO0FBRUEsZUFBZTBILEdBQWYiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIENvbW1hbmQgbGluZSBpbnRlcmZhY2UgZm9yIEpTZm9yY2VcbiAqIEBhdXRob3IgU2hpbmljaGkgVG9taXRhIDxzaGluaWNoaS50b21pdGFAZ21haWwuY29tPlxuICovXG5pbXBvcnQgaHR0cCBmcm9tICdodHRwJztcbmltcG9ydCB1cmwgZnJvbSAndXJsJztcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcbmltcG9ydCBvcGVuVXJsIGZyb20gJ29wZW4nO1xuaW1wb3J0IHsgQ29tbWFuZCB9IGZyb20gJ2NvbW1hbmRlcic7XG5pbXBvcnQgaW5xdWlyZXIgZnJvbSAnaW5xdWlyZXInO1xuaW1wb3J0IHJlcXVlc3QgZnJvbSAnLi4vcmVxdWVzdCc7XG5pbXBvcnQgYmFzZTY0dXJsIGZyb20gJ2Jhc2U2NHVybCc7XG5pbXBvcnQgUmVwbCBmcm9tICcuL3JlcGwnO1xuaW1wb3J0IGpzZm9yY2UsIHsgQ29ubmVjdGlvbiwgT0F1dGgyIH0gZnJvbSAnLi4nO1xuaW1wb3J0IHZlcnNpb24gZnJvbSAnLi4vVkVSU0lPTic7XG5pbXBvcnQgeyBPcHRpb25hbCB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IENsaWVudENvbmZpZyB9IGZyb20gJy4uL3JlZ2lzdHJ5L3R5cGVzJztcblxuY29uc3QgcmVnaXN0cnkgPSBqc2ZvcmNlLnJlZ2lzdHJ5O1xuXG5pbnRlcmZhY2UgQ2xpQ29tbWFuZCBleHRlbmRzIENvbW1hbmQge1xuICBjb25uZWN0aW9uPzogc3RyaW5nO1xuICB1c2VybmFtZT86IHN0cmluZztcbiAgcGFzc3dvcmQ/OiBzdHJpbmc7XG4gIGxvZ2luVXJsPzogc3RyaW5nO1xuICBzYW5kYm94PzogYm9vbGVhbjtcbiAgZXZhbFNjcmlwdD86IHN0cmluZztcbn1cblxuLyoqXG4gKlxuICovXG5leHBvcnQgY2xhc3MgQ2xpIHtcbiAgX3JlcGw6IFJlcGwgPSBuZXcgUmVwbCh0aGlzKTtcbiAgX2Nvbm46IENvbm5lY3Rpb24gPSBuZXcgQ29ubmVjdGlvbigpO1xuICBfY29ubk5hbWU6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgX291dHB1dEVuYWJsZWQ6IGJvb2xlYW4gPSB0cnVlO1xuICBfZGVmYXVsdExvZ2luVXJsOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICByZWFkQ29tbWFuZCgpOiBDbGlDb21tYW5kIHtcbiAgICByZXR1cm4gbmV3IENvbW1hbmQoKVxuICAgICAgLm9wdGlvbignLXUsIC0tdXNlcm5hbWUgW3VzZXJuYW1lXScsICdTYWxlc2ZvcmNlIHVzZXJuYW1lJylcbiAgICAgIC5vcHRpb24oXG4gICAgICAgICctcCwgLS1wYXNzd29yZCBbcGFzc3dvcmRdJyxcbiAgICAgICAgJ1NhbGVzZm9yY2UgcGFzc3dvcmQgKGFuZCBzZWN1cml0eSB0b2tlbiwgaWYgYXZhaWxhYmxlKScsXG4gICAgICApXG4gICAgICAub3B0aW9uKFxuICAgICAgICAnLWMsIC0tY29ubmVjdGlvbiBbY29ubmVjdGlvbl0nLFxuICAgICAgICAnQ29ubmVjdGlvbiBuYW1lIHN0b3JlZCBpbiBjb25uZWN0aW9uIHJlZ2lzdHJ5JyxcbiAgICAgIClcbiAgICAgIC5vcHRpb24oJy1sLCAtLWxvZ2luVXJsIFtsb2dpblVybF0nLCAnU2FsZXNmb3JjZSBsb2dpbiB1cmwnKVxuICAgICAgLm9wdGlvbignLS1zYW5kYm94JywgJ0xvZ2luIHRvIFNhbGVzZm9yY2Ugc2FuZGJveCcpXG4gICAgICAub3B0aW9uKCctZSwgLS1ldmFsU2NyaXB0IFtldmFsU2NyaXB0XScsICdTY3JpcHQgdG8gZXZhbHVhdGUnKVxuICAgICAgLnZlcnNpb24odmVyc2lvbilcbiAgICAgIC5wYXJzZShwcm9jZXNzLmFyZ3YpO1xuICB9XG5cbiAgYXN5bmMgc3RhcnQoKSB7XG4gICAgY29uc3QgcHJvZ3JhbSA9IHRoaXMucmVhZENvbW1hbmQoKTtcbiAgICB0aGlzLl9vdXRwdXRFbmFibGVkID0gIXByb2dyYW0uZXZhbFNjcmlwdDtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5jb25uZWN0KHByb2dyYW0pO1xuICAgICAgaWYgKHByb2dyYW0uZXZhbFNjcmlwdCkge1xuICAgICAgICB0aGlzLl9yZXBsLnN0YXJ0KHtcbiAgICAgICAgICBpbnRlcmFjdGl2ZTogZmFsc2UsXG4gICAgICAgICAgZXZhbFNjcmlwdDogcHJvZ3JhbS5ldmFsU2NyaXB0LFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3JlcGwuc3RhcnQoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIHByb2Nlc3MuZXhpdCgpO1xuICAgIH1cbiAgfVxuXG4gIGdldEN1cnJlbnRDb25uZWN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9jb25uO1xuICB9XG5cbiAgcHJpbnQoLi4uYXJnczogYW55W10pIHtcbiAgICBpZiAodGhpcy5fb3V0cHV0RW5hYmxlZCkge1xuICAgICAgY29uc29sZS5sb2coLi4uYXJncyk7XG4gICAgfVxuICB9XG5cbiAgc2F2ZUN1cnJlbnRDb25uZWN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9jb25uTmFtZSkge1xuICAgICAgY29uc3QgY29ubiA9IHRoaXMuX2Nvbm47XG4gICAgICBjb25zdCBjb25uTmFtZSA9IHRoaXMuX2Nvbm5OYW1lO1xuICAgICAgY29uc3QgY29ubkNvbmZpZyA9IHtcbiAgICAgICAgb2F1dGgyOiBjb25uLm9hdXRoMlxuICAgICAgICAgID8ge1xuICAgICAgICAgICAgICBjbGllbnRJZDogY29ubi5vYXV0aDIuY2xpZW50SWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICBjbGllbnRTZWNyZXQ6IGNvbm4ub2F1dGgyLmNsaWVudFNlY3JldCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIHJlZGlyZWN0VXJpOiBjb25uLm9hdXRoMi5yZWRpcmVjdFVyaSB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIGxvZ2luVXJsOiBjb25uLm9hdXRoMi5sb2dpblVybCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgIGFjY2Vzc1Rva2VuOiBjb25uLmFjY2Vzc1Rva2VuIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgaW5zdGFuY2VVcmw6IGNvbm4uaW5zdGFuY2VVcmwgfHwgdW5kZWZpbmVkLFxuICAgICAgICByZWZyZXNoVG9rZW46IGNvbm4ucmVmcmVzaFRva2VuIHx8IHVuZGVmaW5lZCxcbiAgICAgIH07XG4gICAgICByZWdpc3RyeS5zYXZlQ29ubmVjdGlvbkNvbmZpZyhjb25uTmFtZSwgY29ubkNvbmZpZyk7XG4gICAgfVxuICB9XG5cbiAgc2V0TG9naW5TZXJ2ZXIobG9naW5TZXJ2ZXI6IE9wdGlvbmFsPHN0cmluZz4pIHtcbiAgICBpZiAoIWxvZ2luU2VydmVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChsb2dpblNlcnZlciA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICB0aGlzLl9kZWZhdWx0TG9naW5VcmwgPSAnaHR0cHM6Ly9sb2dpbi5zYWxlc2ZvcmNlLmNvbSc7XG4gICAgfSBlbHNlIGlmIChsb2dpblNlcnZlciA9PT0gJ3NhbmRib3gnKSB7XG4gICAgICB0aGlzLl9kZWZhdWx0TG9naW5VcmwgPSAnaHR0cHM6Ly90ZXN0LnNhbGVzZm9yY2UuY29tJztcbiAgICB9IGVsc2UgaWYgKGxvZ2luU2VydmVyLmluZGV4T2YoJ2h0dHBzOi8vJykgIT09IDApIHtcbiAgICAgIHRoaXMuX2RlZmF1bHRMb2dpblVybCA9ICdodHRwczovLycgKyBsb2dpblNlcnZlcjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZGVmYXVsdExvZ2luVXJsID0gbG9naW5TZXJ2ZXI7XG4gICAgfVxuICAgIHRoaXMucHJpbnQoYFVzaW5nIFwiJHt0aGlzLl9kZWZhdWx0TG9naW5Vcmx9XCIgYXMgZGVmYXVsdCBsb2dpbiBVUkwuYCk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICovXG4gIGFzeW5jIGNvbm5lY3Qob3B0aW9uczoge1xuICAgIHVzZXJuYW1lPzogc3RyaW5nO1xuICAgIHBhc3N3b3JkPzogc3RyaW5nO1xuICAgIGNvbm5lY3Rpb24/OiBzdHJpbmc7XG4gICAgbG9naW5Vcmw/OiBzdHJpbmc7XG4gICAgc2FuZGJveD86IGJvb2xlYW47XG4gIH0pIHtcbiAgICBjb25zdCBsb2dpblNlcnZlciA9IG9wdGlvbnMubG9naW5VcmxcbiAgICAgID8gb3B0aW9ucy5sb2dpblVybFxuICAgICAgOiBvcHRpb25zLnNhbmRib3hcbiAgICAgID8gJ3NhbmRib3gnXG4gICAgICA6IG51bGw7XG4gICAgdGhpcy5zZXRMb2dpblNlcnZlcihsb2dpblNlcnZlcik7XG4gICAgdGhpcy5fY29ubk5hbWUgPSBvcHRpb25zLmNvbm5lY3Rpb247XG4gICAgbGV0IGNvbm5Db25maWcgPSBhd2FpdCByZWdpc3RyeS5nZXRDb25uZWN0aW9uQ29uZmlnKG9wdGlvbnMuY29ubmVjdGlvbik7XG4gICAgbGV0IHVzZXJuYW1lID0gb3B0aW9ucy51c2VybmFtZTtcbiAgICBpZiAoIWNvbm5Db25maWcpIHtcbiAgICAgIGNvbm5Db25maWcgPSB7fTtcbiAgICAgIGlmICh0aGlzLl9kZWZhdWx0TG9naW5VcmwpIHtcbiAgICAgICAgY29ubkNvbmZpZy5sb2dpblVybCA9IHRoaXMuX2RlZmF1bHRMb2dpblVybDtcbiAgICAgIH1cbiAgICAgIHVzZXJuYW1lID0gdXNlcm5hbWUgfHwgb3B0aW9ucy5jb25uZWN0aW9uO1xuICAgIH1cbiAgICB0aGlzLl9jb25uID0gbmV3IENvbm5lY3Rpb24oY29ubkNvbmZpZyk7XG4gICAgY29uc3QgcGFzc3dvcmQgPSBvcHRpb25zLnBhc3N3b3JkO1xuICAgIGlmICh1c2VybmFtZSkge1xuICAgICAgYXdhaXQgdGhpcy5zdGFydFBhc3N3b3JkQXV0aCh1c2VybmFtZSwgcGFzc3dvcmQpO1xuICAgICAgdGhpcy5zYXZlQ3VycmVudENvbm5lY3Rpb24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuX2Nvbm5OYW1lICYmIHRoaXMuX2Nvbm4uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgdGhpcy5fY29ubi5vbigncmVmcmVzaCcsICgpID0+IHtcbiAgICAgICAgICB0aGlzLnByaW50KCdSZWZyZXNoaW5nIGFjY2VzcyB0b2tlbiAuLi4gJyk7XG4gICAgICAgICAgdGhpcy5zYXZlQ3VycmVudENvbm5lY3Rpb24oKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgaWRlbnRpdHkgPSBhd2FpdCB0aGlzLl9jb25uLmlkZW50aXR5KCk7XG4gICAgICAgICAgdGhpcy5wcmludChgTG9nZ2VkIGluIGFzIDogJHtpZGVudGl0eS51c2VybmFtZX1gKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgdGhpcy5wcmludChlcnIubWVzc2FnZSk7XG4gICAgICAgICAgaWYgKHRoaXMuX2Nvbm4ub2F1dGgyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BsZWFzZSByZS1hdXRob3JpemUgY29ubmVjdGlvbi4nKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zdGFydFBhc3N3b3JkQXV0aCh0aGlzLl9jb25uTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBhc3luYyBzdGFydFBhc3N3b3JkQXV0aCh1c2VybmFtZTogc3RyaW5nLCBwYXNzd29yZD86IHN0cmluZykge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmxvZ2luQnlQYXNzd29yZCh1c2VybmFtZSwgcGFzc3dvcmQsIDIpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyci5tZXNzYWdlID09PSAnY2FuY2VsZWQnKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Bhc3N3b3JkIGF1dGhlbnRpY2F0aW9uIGNhbmNlbGVkOiBOb3QgbG9nZ2VkIGluJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBhc3luYyBsb2dpbkJ5UGFzc3dvcmQoXG4gICAgdXNlcm5hbWU6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nIHwgdW5kZWZpbmVkLFxuICAgIHJldHJ5Q291bnQ6IG51bWJlcixcbiAgKTogUHJvbWlzZTx7IGlkOiBzdHJpbmcgfT4ge1xuICAgIGlmIChwYXNzd29yZCA9PT0gJycpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY2FuY2VsZWQnKTtcbiAgICB9XG4gICAgaWYgKHBhc3N3b3JkID09IG51bGwpIHtcbiAgICAgIGNvbnN0IHBhc3MgPSBhd2FpdCB0aGlzLnByb21wdFBhc3N3b3JkKCdQYXNzd29yZDogJyk7XG4gICAgICByZXR1cm4gdGhpcy5sb2dpbkJ5UGFzc3dvcmQodXNlcm5hbWUsIHBhc3MsIHJldHJ5Q291bnQpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5fY29ubi5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpO1xuICAgICAgdGhpcy5wcmludChgTG9nZ2VkIGluIGFzIDogJHt1c2VybmFtZX1gKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKTtcbiAgICAgIGlmIChyZXRyeUNvdW50ID4gMCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2dpbkJ5UGFzc3dvcmQodXNlcm5hbWUsIHVuZGVmaW5lZCwgcmV0cnlDb3VudCAtIDEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjYW5jZWxlZCcpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgZGlzY29ubmVjdChjb25uTmFtZT86IHN0cmluZykge1xuICAgIGNvbnN0IG5hbWUgPSBjb25uTmFtZSB8fCB0aGlzLl9jb25uTmFtZTtcbiAgICBpZiAobmFtZSAmJiByZWdpc3RyeS5nZXRDb25uZWN0aW9uQ29uZmlnKG5hbWUpKSB7XG4gICAgICByZWdpc3RyeS5yZW1vdmVDb25uZWN0aW9uQ29uZmlnKG5hbWUpO1xuICAgICAgdGhpcy5wcmludChgRGlzY29ubmVjdCBjb25uZWN0aW9uICcke25hbWV9J2ApO1xuICAgIH1cbiAgICB0aGlzLl9jb25uTmFtZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLl9jb25uID0gbmV3IENvbm5lY3Rpb24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgYXV0aG9yaXplKGNsaWVudE5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IG5hbWUgPSBjbGllbnROYW1lIHx8ICdkZWZhdWx0JztcbiAgICB2YXIgb2F1dGgyQ29uZmlnID0gYXdhaXQgcmVnaXN0cnkuZ2V0Q2xpZW50Q29uZmlnKG5hbWUpO1xuICAgIGlmICghb2F1dGgyQ29uZmlnIHx8ICFvYXV0aDJDb25maWcuY2xpZW50SWQpIHtcbiAgICAgIGlmIChuYW1lID09PSAnZGVmYXVsdCcgfHwgbmFtZSA9PT0gJ3NhbmRib3gnKSB7XG4gICAgICAgIHRoaXMucHJpbnQoXG4gICAgICAgICAgJ05vIGNsaWVudCBpbmZvcm1hdGlvbiByZWdpc3RlcmVkLiBEb3dubG9hZGluZyBKU2ZvcmNlIGRlZmF1bHQgY2xpZW50IGluZm9ybWF0aW9uLi4uJyxcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG93bmxvYWREZWZhdWx0Q2xpZW50SW5mbyhuYW1lKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYE5vIE9BdXRoMiBjbGllbnQgaW5mb3JtYXRpb24gcmVnaXN0ZXJlZCA6ICcke25hbWV9Jy4gUGxlYXNlIHJlZ2lzdGVyIGNsaWVudCBpbmZvIGZpcnN0LmAsXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBvYXV0aDIgPSBuZXcgT0F1dGgyKG9hdXRoMkNvbmZpZyk7XG4gICAgY29uc3QgdmVyaWZpZXIgPSBiYXNlNjR1cmwuZW5jb2RlKGNyeXB0by5yYW5kb21CeXRlcygzMikpO1xuICAgIGNvbnN0IGNoYWxsZW5nZSA9IGJhc2U2NHVybC5lbmNvZGUoXG4gICAgICBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKHZlcmlmaWVyKS5kaWdlc3QoKSxcbiAgICApO1xuICAgIGNvbnN0IHN0YXRlID0gYmFzZTY0dXJsLmVuY29kZShjcnlwdG8ucmFuZG9tQnl0ZXMoMzIpKTtcbiAgICBjb25zdCBhdXRoelVybCA9IG9hdXRoMi5nZXRBdXRob3JpemF0aW9uVXJsKHtcbiAgICAgIGNvZGVfY2hhbGxlbmdlOiBjaGFsbGVuZ2UsXG4gICAgICBzdGF0ZSxcbiAgICB9KTtcbiAgICB0aGlzLnByaW50KCdPcGVuaW5nIGF1dGhvcml6YXRpb24gcGFnZSBpbiBicm93c2VyLi4uJyk7XG4gICAgdGhpcy5wcmludChgVVJMOiAke2F1dGh6VXJsfWApO1xuICAgIHRoaXMub3BlblVybChhdXRoelVybCk7XG4gICAgY29uc3QgcGFyYW1zID0gYXdhaXQgdGhpcy53YWl0Q2FsbGJhY2sob2F1dGgyQ29uZmlnLnJlZGlyZWN0VXJpLCBzdGF0ZSk7XG4gICAgaWYgKCFwYXJhbXMuY29kZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBhdXRob3JpemF0aW9uIGNvZGUgcmV0dXJuZWQuJyk7XG4gICAgfVxuICAgIGlmIChwYXJhbXMuc3RhdGUgIT09IHN0YXRlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgc3RhdGUgcGFyYW1ldGVyIHJldHVybmVkLicpO1xuICAgIH1cbiAgICB0aGlzLl9jb25uID0gbmV3IENvbm5lY3Rpb24oeyBvYXV0aDIgfSk7XG4gICAgdGhpcy5wcmludChcbiAgICAgICdSZWNlaXZlZCBhdXRob3JpemF0aW9uIGNvZGUuIFBsZWFzZSBjbG9zZSB0aGUgb3BlbmVkIGJyb3dzZXIgd2luZG93LicsXG4gICAgKTtcbiAgICBhd2FpdCB0aGlzLl9jb25uLmF1dGhvcml6ZShwYXJhbXMuY29kZSwgeyBjb2RlX3ZlcmlmaWVyOiB2ZXJpZmllciB9KTtcbiAgICB0aGlzLnByaW50KCdBdXRob3JpemVkLiBGZXRjaGluZyB1c2VyIGluZm8uLi4nKTtcbiAgICBjb25zdCBpZGVudGl0eSA9IGF3YWl0IHRoaXMuX2Nvbm4uaWRlbnRpdHkoKTtcbiAgICB0aGlzLnByaW50KGBMb2dnZWQgaW4gYXMgOiAke2lkZW50aXR5LnVzZXJuYW1lfWApO1xuICAgIHRoaXMuX2Nvbm5OYW1lID0gaWRlbnRpdHkudXNlcm5hbWU7XG4gICAgdGhpcy5zYXZlQ3VycmVudENvbm5lY3Rpb24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgZG93bmxvYWREZWZhdWx0Q2xpZW50SW5mbyhjbGllbnROYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb25maWdVcmwgPSAnaHR0cHM6Ly9qc2ZvcmNlLmdpdGh1Yi5pby9jbGllbnQtY29uZmlnL2RlZmF1bHQuanNvbic7XG4gICAgY29uc3QgcmVzOiB7IGJvZHk6IHN0cmluZyB9ID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgcmVxdWVzdCh7IG1ldGhvZDogJ0dFVCcsIHVybDogY29uZmlnVXJsIH0pXG4gICAgICAgIC5vbignY29tcGxldGUnLCByZXNvbHZlKVxuICAgICAgICAub24oJ2Vycm9yJywgcmVqZWN0KTtcbiAgICB9KTtcbiAgICBjb25zdCBjbGllbnRDb25maWcgPSBKU09OLnBhcnNlKHJlcy5ib2R5KTtcbiAgICBpZiAoY2xpZW50TmFtZSA9PT0gJ3NhbmRib3gnKSB7XG4gICAgICBjbGllbnRDb25maWcubG9naW5VcmwgPSAnaHR0cHM6Ly90ZXN0LnNhbGVzZm9yY2UuY29tJztcbiAgICB9XG4gICAgYXdhaXQgcmVnaXN0cnkucmVnaXN0ZXJDbGllbnRDb25maWcoY2xpZW50TmFtZSwgY2xpZW50Q29uZmlnKTtcbiAgICB0aGlzLnByaW50KCdDbGllbnQgaW5mb3JtYXRpb24gZG93bmxvYWRlZCBzdWNjZXNzZnVsbHkuJyk7XG4gICAgcmV0dXJuIHRoaXMuYXV0aG9yaXplKGNsaWVudE5hbWUpO1xuICB9XG5cbiAgYXN5bmMgd2FpdENhbGxiYWNrKFxuICAgIHNlcnZlclVybDogc3RyaW5nIHwgdW5kZWZpbmVkLFxuICAgIHN0YXRlOiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyBjb2RlOiBzdHJpbmc7IHN0YXRlOiBzdHJpbmcgfT4ge1xuICAgIGlmIChzZXJ2ZXJVcmwgJiYgc2VydmVyVXJsLmluZGV4T2YoJ2h0dHA6Ly9sb2NhbGhvc3Q6JykgPT09IDApIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHNlcnZlciA9IGh0dHAuY3JlYXRlU2VydmVyKChyZXEsIHJlcykgPT4ge1xuICAgICAgICAgIGlmICghcmVxLnVybCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBxcGFyYW1zID0gdXJsLnBhcnNlKHJlcS51cmwsIHRydWUpLnF1ZXJ5O1xuICAgICAgICAgIHJlcy53cml0ZUhlYWQoMjAwLCB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9odG1sJyB9KTtcbiAgICAgICAgICByZXMud3JpdGUoXG4gICAgICAgICAgICAnPGh0bWw+PHNjcmlwdD5sb2NhdGlvbi5ocmVmPVwiYWJvdXQ6YmxhbmtcIjs8L3NjcmlwdD48L2h0bWw+JyxcbiAgICAgICAgICApO1xuICAgICAgICAgIHJlcy5lbmQoKTtcbiAgICAgICAgICBpZiAocXBhcmFtcy5lcnJvcikge1xuICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihxcGFyYW1zLmVycm9yIGFzIHN0cmluZykpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlKHFwYXJhbXMgYXMgeyBjb2RlOiBzdHJpbmc7IHN0YXRlOiBzdHJpbmcgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNlcnZlci5jbG9zZSgpO1xuICAgICAgICAgIHJlcS5jb25uZWN0aW9uLmVuZCgpO1xuICAgICAgICAgIHJlcS5jb25uZWN0aW9uLmRlc3Ryb3koKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHBvcnQgPSBOdW1iZXIodXJsLnBhcnNlKHNlcnZlclVybCkucG9ydCk7XG4gICAgICAgIHNlcnZlci5saXN0ZW4ocG9ydCwgJ2xvY2FsaG9zdCcpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGNvZGUgPSBhd2FpdCB0aGlzLnByb21wdE1lc3NhZ2UoXG4gICAgICAgICdDb3B5ICYgcGFzdGUgYXV0aHogY29kZSBwYXNzZWQgaW4gcmVkaXJlY3RlZCBVUkw6ICcsXG4gICAgICApO1xuICAgICAgcmV0dXJuIHsgY29kZTogZGVjb2RlVVJJQ29tcG9uZW50KGNvZGUpLCBzdGF0ZSB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgcmVnaXN0ZXIoY2xpZW50TmFtZTogc3RyaW5nIHwgdW5kZWZpbmVkLCBjbGllbnRDb25maWc6IENsaWVudENvbmZpZykge1xuICAgIGNvbnN0IG5hbWUgPSBjbGllbnROYW1lIHx8ICdkZWZhdWx0JztcbiAgICBjb25zdCBwcm9tcHRzID0ge1xuICAgICAgY2xpZW50SWQ6ICdJbnB1dCBjbGllbnQgSUQgOiAnLFxuICAgICAgY2xpZW50U2VjcmV0OiAnSW5wdXQgY2xpZW50IHNlY3JldCAob3B0aW9uYWwpIDogJyxcbiAgICAgIHJlZGlyZWN0VXJpOiAnSW5wdXQgcmVkaXJlY3QgVVJJIDogJyxcbiAgICAgIGxvZ2luVXJsOiAnSW5wdXQgbG9naW4gVVJMIChkZWZhdWx0IGlzIGh0dHBzOi8vbG9naW4uc2FsZXNmb3JjZS5jb20pIDogJyxcbiAgICB9O1xuICAgIGNvbnN0IHJlZ2lzdGVyZWQgPSBhd2FpdCByZWdpc3RyeS5nZXRDbGllbnRDb25maWcobmFtZSk7XG4gICAgaWYgKHJlZ2lzdGVyZWQpIHtcbiAgICAgIGNvbnN0IG1zZyA9IGBDbGllbnQgJyR7bmFtZX0nIGlzIGFscmVhZHkgcmVnaXN0ZXJlZC4gQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIG92ZXJyaWRlID8gW3lOXSA6IGA7XG4gICAgICBjb25zdCBvayA9IGF3YWl0IHRoaXMucHJvbXB0Q29uZmlybShtc2cpO1xuICAgICAgaWYgKCFvaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZ2lzdHJhdGlvbiBjYW5jZWxlZC4nKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY2xpZW50Q29uZmlnID0gYXdhaXQgT2JqZWN0LmtleXMocHJvbXB0cykucmVkdWNlKGFzeW5jIChwcm9taXNlLCBuYW1lKSA9PiB7XG4gICAgICBjb25zdCBjY29uZmlnID0gYXdhaXQgcHJvbWlzZTtcbiAgICAgIGNvbnN0IHByb21wdE5hbWUgPSBuYW1lIGFzIGtleW9mIHR5cGVvZiBwcm9tcHRzO1xuICAgICAgY29uc3QgbWVzc2FnZSA9IHByb21wdHNbcHJvbXB0TmFtZV07XG4gICAgICBpZiAoIWNjb25maWdbcHJvbXB0TmFtZV0pIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLnByb21wdE1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5jY29uZmlnLFxuICAgICAgICAgICAgW3Byb21wdE5hbWVdOiB2YWx1ZSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gY2NvbmZpZztcbiAgICB9LCBQcm9taXNlLnJlc29sdmUoY2xpZW50Q29uZmlnKSk7XG4gICAgYXdhaXQgcmVnaXN0cnkucmVnaXN0ZXJDbGllbnRDb25maWcobmFtZSwgY2xpZW50Q29uZmlnKTtcbiAgICB0aGlzLnByaW50KCdDbGllbnQgcmVnaXN0ZXJlZCBzdWNjZXNzZnVsbHkuJyk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICovXG4gIGFzeW5jIGxpc3RDb25uZWN0aW9ucygpIHtcbiAgICBjb25zdCBuYW1lcyA9IGF3YWl0IHJlZ2lzdHJ5LmdldENvbm5lY3Rpb25OYW1lcygpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBuYW1lID0gbmFtZXNbaV07XG4gICAgICB0aGlzLnByaW50KChuYW1lID09PSB0aGlzLl9jb25uTmFtZSA/ICcqICcgOiAnICAnKSArIG5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgZ2V0Q29ubmVjdGlvbk5hbWVzKCkge1xuICAgIHJldHVybiByZWdpc3RyeS5nZXRDb25uZWN0aW9uTmFtZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgZ2V0Q2xpZW50TmFtZXMoKSB7XG4gICAgcmV0dXJuIHJlZ2lzdHJ5LmdldENsaWVudE5hbWVzKCk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICovXG4gIGFzeW5jIHByb21wdCh0eXBlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZykge1xuICAgIHRoaXMuX3JlcGwucGF1c2UoKTtcbiAgICBjb25zdCBhbnN3ZXI6IHsgdmFsdWU6IHN0cmluZyB9ID0gYXdhaXQgaW5xdWlyZXIucHJvbXB0KFtcbiAgICAgIHtcbiAgICAgICAgdHlwZSxcbiAgICAgICAgbmFtZTogJ3ZhbHVlJyxcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgIH0sXG4gICAgXSk7XG4gICAgdGhpcy5fcmVwbC5yZXN1bWUoKTtcbiAgICByZXR1cm4gYW5zd2VyLnZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBhc3luYyBwcm9tcHRNZXNzYWdlKG1lc3NhZ2U6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnByb21wdCgnaW5wdXQnLCBtZXNzYWdlKTtcbiAgfVxuXG4gIGFzeW5jIHByb21wdFBhc3N3b3JkKG1lc3NhZ2U6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnByb21wdCgncGFzc3dvcmQnLCBtZXNzYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgcHJvbXB0Q29uZmlybShtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5wcm9tcHQoJ2NvbmZpcm0nLCBtZXNzYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgb3BlblVybCh1cmw6IHN0cmluZykge1xuICAgIG9wZW5VcmwodXJsKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgb3BlblVybFVzaW5nU2Vzc2lvbih1cmw/OiBzdHJpbmcpIHtcbiAgICBsZXQgZnJvbnRkb29yVXJsID0gYCR7dGhpcy5fY29ubi5pbnN0YW5jZVVybH0vc2VjdXIvZnJvbnRkb29yLmpzcD9zaWQ9JHt0aGlzLl9jb25uLmFjY2Vzc1Rva2VufWA7XG4gICAgaWYgKHVybCkge1xuICAgICAgZnJvbnRkb29yVXJsICs9ICcmcmV0VVJMPScgKyBlbmNvZGVVUklDb21wb25lbnQodXJsKTtcbiAgICB9XG4gICAgdGhpcy5vcGVuVXJsKGZyb250ZG9vclVybCk7XG4gIH1cbn1cblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb25zdCBjbGkgPSBuZXcgQ2xpKCk7XG5cbmV4cG9ydCBkZWZhdWx0IGNsaTtcbiJdfQ==