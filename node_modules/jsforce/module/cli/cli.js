import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import "core-js/modules/es.array.iterator";
import "core-js/modules/es.promise";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import _reduceInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/reduce";
import _Promise from "@babel/runtime-corejs3/core-js-stable/promise";
import _indexOfInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/index-of";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";

function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context2; _forEachInstanceProperty(_context2 = ownKeys(Object(source), true)).call(_context2, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context3; _forEachInstanceProperty(_context3 = ownKeys(Object(source))).call(_context3, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }

/**
 * @file Command line interface for JSforce
 * @author Shinichi Tomita <shinichi.tomita@gmail.com>
 */
import http from 'http';
import url from 'url';
import crypto from 'crypto';
import openUrl from 'open';
import { Command } from 'commander';
import inquirer from 'inquirer';
import request from '../request';
import base64url from 'base64url';
import Repl from './repl';
import jsforce, { Connection, OAuth2 } from '..';
import version from '../VERSION';
const registry = jsforce.registry;

/**
 *
 */
export class Cli {
  constructor() {
    _defineProperty(this, "_repl", new Repl(this));

    _defineProperty(this, "_conn", new Connection());

    _defineProperty(this, "_connName", undefined);

    _defineProperty(this, "_outputEnabled", true);

    _defineProperty(this, "_defaultLoginUrl", undefined);
  }

  /**
   *
   */
  readCommand() {
    return new Command().option('-u, --username [username]', 'Salesforce username').option('-p, --password [password]', 'Salesforce password (and security token, if available)').option('-c, --connection [connection]', 'Connection name stored in connection registry').option('-l, --loginUrl [loginUrl]', 'Salesforce login url').option('--sandbox', 'Login to Salesforce sandbox').option('-e, --evalScript [evalScript]', 'Script to evaluate').version(version).parse(process.argv);
  }

  async start() {
    const program = this.readCommand();
    this._outputEnabled = !program.evalScript;

    try {
      await this.connect(program);

      if (program.evalScript) {
        this._repl.start({
          interactive: false,
          evalScript: program.evalScript
        });
      } else {
        this._repl.start();
      }
    } catch (err) {
      console.error(err);
      process.exit();
    }
  }

  getCurrentConnection() {
    return this._conn;
  }

  print(...args) {
    if (this._outputEnabled) {
      console.log(...args);
    }
  }

  saveCurrentConnection() {
    if (this._connName) {
      const conn = this._conn;
      const connName = this._connName;
      const connConfig = {
        oauth2: conn.oauth2 ? {
          clientId: conn.oauth2.clientId || undefined,
          clientSecret: conn.oauth2.clientSecret || undefined,
          redirectUri: conn.oauth2.redirectUri || undefined,
          loginUrl: conn.oauth2.loginUrl || undefined
        } : undefined,
        accessToken: conn.accessToken || undefined,
        instanceUrl: conn.instanceUrl || undefined,
        refreshToken: conn.refreshToken || undefined
      };
      registry.saveConnectionConfig(connName, connConfig);
    }
  }

  setLoginServer(loginServer) {
    if (!loginServer) {
      return;
    }

    if (loginServer === 'production') {
      this._defaultLoginUrl = 'https://login.salesforce.com';
    } else if (loginServer === 'sandbox') {
      this._defaultLoginUrl = 'https://test.salesforce.com';
    } else if (_indexOfInstanceProperty(loginServer).call(loginServer, 'https://') !== 0) {
      this._defaultLoginUrl = 'https://' + loginServer;
    } else {
      this._defaultLoginUrl = loginServer;
    }

    this.print(`Using "${this._defaultLoginUrl}" as default login URL.`);
  }
  /**
   *
   */


  async connect(options) {
    const loginServer = options.loginUrl ? options.loginUrl : options.sandbox ? 'sandbox' : null;
    this.setLoginServer(loginServer);
    this._connName = options.connection;
    let connConfig = await registry.getConnectionConfig(options.connection);
    let username = options.username;

    if (!connConfig) {
      connConfig = {};

      if (this._defaultLoginUrl) {
        connConfig.loginUrl = this._defaultLoginUrl;
      }

      username = username || options.connection;
    }

    this._conn = new Connection(connConfig);
    const password = options.password;

    if (username) {
      await this.startPasswordAuth(username, password);
      this.saveCurrentConnection();
    } else {
      if (this._connName && this._conn.accessToken) {
        this._conn.on('refresh', () => {
          this.print('Refreshing access token ... ');
          this.saveCurrentConnection();
        });

        try {
          const identity = await this._conn.identity();
          this.print(`Logged in as : ${identity.username}`);
        } catch (err) {
          this.print(err.message);

          if (this._conn.oauth2) {
            throw new Error('Please re-authorize connection.');
          } else {
            await this.startPasswordAuth(this._connName);
          }
        }
      }
    }
  }
  /**
   *
   */


  async startPasswordAuth(username, password) {
    try {
      await this.loginByPassword(username, password, 2);
    } catch (err) {
      if (err.message === 'canceled') {
        console.error('Password authentication canceled: Not logged in');
      } else {
        throw err;
      }
    }
  }
  /**
   *
   */


  async loginByPassword(username, password, retryCount) {
    if (password === '') {
      throw new Error('canceled');
    }

    if (password == null) {
      const pass = await this.promptPassword('Password: ');
      return this.loginByPassword(username, pass, retryCount);
    }

    try {
      const result = await this._conn.login(username, password);
      this.print(`Logged in as : ${username}`);
      return result;
    } catch (err) {
      console.error(err.message);

      if (retryCount > 0) {
        return this.loginByPassword(username, undefined, retryCount - 1);
      } else {
        throw new Error('canceled');
      }
    }
  }
  /**
   *
   */


  disconnect(connName) {
    const name = connName || this._connName;

    if (name && registry.getConnectionConfig(name)) {
      registry.removeConnectionConfig(name);
      this.print(`Disconnect connection '${name}'`);
    }

    this._connName = undefined;
    this._conn = new Connection();
  }
  /**
   *
   */


  async authorize(clientName) {
    const name = clientName || 'default';
    var oauth2Config = await registry.getClientConfig(name);

    if (!oauth2Config || !oauth2Config.clientId) {
      if (name === 'default' || name === 'sandbox') {
        this.print('No client information registered. Downloading JSforce default client information...');
        return this.downloadDefaultClientInfo(name);
      }

      throw new Error(`No OAuth2 client information registered : '${name}'. Please register client info first.`);
    }

    const oauth2 = new OAuth2(oauth2Config);
    const verifier = base64url.encode(crypto.randomBytes(32));
    const challenge = base64url.encode(crypto.createHash('sha256').update(verifier).digest());
    const state = base64url.encode(crypto.randomBytes(32));
    const authzUrl = oauth2.getAuthorizationUrl({
      code_challenge: challenge,
      state
    });
    this.print('Opening authorization page in browser...');
    this.print(`URL: ${authzUrl}`);
    this.openUrl(authzUrl);
    const params = await this.waitCallback(oauth2Config.redirectUri, state);

    if (!params.code) {
      throw new Error('No authorization code returned.');
    }

    if (params.state !== state) {
      throw new Error('Invalid state parameter returned.');
    }

    this._conn = new Connection({
      oauth2
    });
    this.print('Received authorization code. Please close the opened browser window.');
    await this._conn.authorize(params.code, {
      code_verifier: verifier
    });
    this.print('Authorized. Fetching user info...');
    const identity = await this._conn.identity();
    this.print(`Logged in as : ${identity.username}`);
    this._connName = identity.username;
    this.saveCurrentConnection();
  }
  /**
   *
   */


  async downloadDefaultClientInfo(clientName) {
    const configUrl = 'https://jsforce.github.io/client-config/default.json';
    const res = await new _Promise((resolve, reject) => {
      request({
        method: 'GET',
        url: configUrl
      }).on('complete', resolve).on('error', reject);
    });
    const clientConfig = JSON.parse(res.body);

    if (clientName === 'sandbox') {
      clientConfig.loginUrl = 'https://test.salesforce.com';
    }

    await registry.registerClientConfig(clientName, clientConfig);
    this.print('Client information downloaded successfully.');
    return this.authorize(clientName);
  }

  async waitCallback(serverUrl, state) {
    if (serverUrl && _indexOfInstanceProperty(serverUrl).call(serverUrl, 'http://localhost:') === 0) {
      return new _Promise((resolve, reject) => {
        const server = http.createServer((req, res) => {
          if (!req.url) {
            return;
          }

          const qparams = url.parse(req.url, true).query;
          res.writeHead(200, {
            'Content-Type': 'text/html'
          });
          res.write('<html><script>location.href="about:blank";</script></html>');
          res.end();

          if (qparams.error) {
            reject(new Error(qparams.error));
          } else {
            resolve(qparams);
          }

          server.close();
          req.connection.end();
          req.connection.destroy();
        });
        const port = Number(url.parse(serverUrl).port);
        server.listen(port, 'localhost');
      });
    } else {
      const code = await this.promptMessage('Copy & paste authz code passed in redirected URL: ');
      return {
        code: decodeURIComponent(code),
        state
      };
    }
  }
  /**
   *
   */


  async register(clientName, clientConfig) {
    var _context;

    const name = clientName || 'default';
    const prompts = {
      clientId: 'Input client ID : ',
      clientSecret: 'Input client secret (optional) : ',
      redirectUri: 'Input redirect URI : ',
      loginUrl: 'Input login URL (default is https://login.salesforce.com) : '
    };
    const registered = await registry.getClientConfig(name);

    if (registered) {
      const msg = `Client '${name}' is already registered. Are you sure you want to override ? [yN] : `;
      const ok = await this.promptConfirm(msg);

      if (!ok) {
        throw new Error('Registration canceled.');
      }
    }

    clientConfig = await _reduceInstanceProperty(_context = _Object$keys(prompts)).call(_context, async (promise, name) => {
      const cconfig = await promise;
      const promptName = name;
      const message = prompts[promptName];

      if (!cconfig[promptName]) {
        const value = await this.promptMessage(message);

        if (value) {
          return _objectSpread(_objectSpread({}, cconfig), {}, {
            [promptName]: value
          });
        }
      }

      return cconfig;
    }, _Promise.resolve(clientConfig));
    await registry.registerClientConfig(name, clientConfig);
    this.print('Client registered successfully.');
  }
  /**
   *
   */


  async listConnections() {
    const names = await registry.getConnectionNames();

    for (var i = 0; i < names.length; i++) {
      var name = names[i];
      this.print((name === this._connName ? '* ' : '  ') + name);
    }
  }
  /**
   *
   */


  async getConnectionNames() {
    return registry.getConnectionNames();
  }
  /**
   *
   */


  async getClientNames() {
    return registry.getClientNames();
  }
  /**
   *
   */


  async prompt(type, message) {
    this._repl.pause();

    const answer = await inquirer.prompt([{
      type,
      name: 'value',
      message
    }]);

    this._repl.resume();

    return answer.value;
  }
  /**
   *
   */


  async promptMessage(message) {
    return this.prompt('input', message);
  }

  async promptPassword(message) {
    return this.prompt('password', message);
  }
  /**
   *
   */


  async promptConfirm(message) {
    return this.prompt('confirm', message);
  }
  /**
   *
   */


  openUrl(url) {
    openUrl(url);
  }
  /**
   *
   */


  openUrlUsingSession(url) {
    let frontdoorUrl = `${this._conn.instanceUrl}/secur/frontdoor.jsp?sid=${this._conn.accessToken}`;

    if (url) {
      frontdoorUrl += '&retURL=' + encodeURIComponent(url);
    }

    this.openUrl(frontdoorUrl);
  }

}
/* ------------------------------------------------------------------------- */

const cli = new Cli();
export default cli;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGkvY2xpLnRzIl0sIm5hbWVzIjpbImh0dHAiLCJ1cmwiLCJjcnlwdG8iLCJvcGVuVXJsIiwiQ29tbWFuZCIsImlucXVpcmVyIiwicmVxdWVzdCIsImJhc2U2NHVybCIsIlJlcGwiLCJqc2ZvcmNlIiwiQ29ubmVjdGlvbiIsIk9BdXRoMiIsInZlcnNpb24iLCJyZWdpc3RyeSIsIkNsaSIsInVuZGVmaW5lZCIsInJlYWRDb21tYW5kIiwib3B0aW9uIiwicGFyc2UiLCJwcm9jZXNzIiwiYXJndiIsInN0YXJ0IiwicHJvZ3JhbSIsIl9vdXRwdXRFbmFibGVkIiwiZXZhbFNjcmlwdCIsImNvbm5lY3QiLCJfcmVwbCIsImludGVyYWN0aXZlIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZXhpdCIsImdldEN1cnJlbnRDb25uZWN0aW9uIiwiX2Nvbm4iLCJwcmludCIsImFyZ3MiLCJsb2ciLCJzYXZlQ3VycmVudENvbm5lY3Rpb24iLCJfY29ubk5hbWUiLCJjb25uIiwiY29ubk5hbWUiLCJjb25uQ29uZmlnIiwib2F1dGgyIiwiY2xpZW50SWQiLCJjbGllbnRTZWNyZXQiLCJyZWRpcmVjdFVyaSIsImxvZ2luVXJsIiwiYWNjZXNzVG9rZW4iLCJpbnN0YW5jZVVybCIsInJlZnJlc2hUb2tlbiIsInNhdmVDb25uZWN0aW9uQ29uZmlnIiwic2V0TG9naW5TZXJ2ZXIiLCJsb2dpblNlcnZlciIsIl9kZWZhdWx0TG9naW5VcmwiLCJvcHRpb25zIiwic2FuZGJveCIsImNvbm5lY3Rpb24iLCJnZXRDb25uZWN0aW9uQ29uZmlnIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInN0YXJ0UGFzc3dvcmRBdXRoIiwib24iLCJpZGVudGl0eSIsIm1lc3NhZ2UiLCJFcnJvciIsImxvZ2luQnlQYXNzd29yZCIsInJldHJ5Q291bnQiLCJwYXNzIiwicHJvbXB0UGFzc3dvcmQiLCJyZXN1bHQiLCJsb2dpbiIsImRpc2Nvbm5lY3QiLCJuYW1lIiwicmVtb3ZlQ29ubmVjdGlvbkNvbmZpZyIsImF1dGhvcml6ZSIsImNsaWVudE5hbWUiLCJvYXV0aDJDb25maWciLCJnZXRDbGllbnRDb25maWciLCJkb3dubG9hZERlZmF1bHRDbGllbnRJbmZvIiwidmVyaWZpZXIiLCJlbmNvZGUiLCJyYW5kb21CeXRlcyIsImNoYWxsZW5nZSIsImNyZWF0ZUhhc2giLCJ1cGRhdGUiLCJkaWdlc3QiLCJzdGF0ZSIsImF1dGh6VXJsIiwiZ2V0QXV0aG9yaXphdGlvblVybCIsImNvZGVfY2hhbGxlbmdlIiwicGFyYW1zIiwid2FpdENhbGxiYWNrIiwiY29kZSIsImNvZGVfdmVyaWZpZXIiLCJjb25maWdVcmwiLCJyZXMiLCJyZXNvbHZlIiwicmVqZWN0IiwibWV0aG9kIiwiY2xpZW50Q29uZmlnIiwiSlNPTiIsImJvZHkiLCJyZWdpc3RlckNsaWVudENvbmZpZyIsInNlcnZlclVybCIsInNlcnZlciIsImNyZWF0ZVNlcnZlciIsInJlcSIsInFwYXJhbXMiLCJxdWVyeSIsIndyaXRlSGVhZCIsIndyaXRlIiwiZW5kIiwiY2xvc2UiLCJkZXN0cm95IiwicG9ydCIsIk51bWJlciIsImxpc3RlbiIsInByb21wdE1lc3NhZ2UiLCJkZWNvZGVVUklDb21wb25lbnQiLCJyZWdpc3RlciIsInByb21wdHMiLCJyZWdpc3RlcmVkIiwibXNnIiwib2siLCJwcm9tcHRDb25maXJtIiwicHJvbWlzZSIsImNjb25maWciLCJwcm9tcHROYW1lIiwidmFsdWUiLCJsaXN0Q29ubmVjdGlvbnMiLCJuYW1lcyIsImdldENvbm5lY3Rpb25OYW1lcyIsImkiLCJsZW5ndGgiLCJnZXRDbGllbnROYW1lcyIsInByb21wdCIsInR5cGUiLCJwYXVzZSIsImFuc3dlciIsInJlc3VtZSIsIm9wZW5VcmxVc2luZ1Nlc3Npb24iLCJmcm9udGRvb3JVcmwiLCJlbmNvZGVVUklDb21wb25lbnQiLCJjbGkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU9BLElBQVAsTUFB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QUFjO0FBQ25CRSxJQUFBQSxPQUFPLENBQUNGLEdBQUQsQ0FBUDtBQUNEO0FBRUQ7QUFDRjtBQUNBOzs7QUFDRTJJLEVBQUFBLG1CQUFtQixDQUFDM0ksR0FBRCxFQUFlO0FBQ2hDLFFBQUk0SSxZQUFZLEdBQUksR0FBRSxLQUFLNUcsS0FBTCxDQUFXZSxXQUFZLDRCQUEyQixLQUFLZixLQUFMLENBQVdjLFdBQVksRUFBL0Y7O0FBQ0EsUUFBSTlDLEdBQUosRUFBUztBQUNQNEksTUFBQUEsWUFBWSxJQUFJLGFBQWFDLGtCQUFrQixDQUFDN0ksR0FBRCxDQUEvQztBQUNEOztBQUNELFNBQUtFLE9BQUwsQ0FBYTBJLFlBQWI7QUFDRDs7QUFwYWM7QUF1YWpCOztBQUVBLE1BQU1FLEdBQUcsR0FBRyxJQUFJakksR0FBSixFQUFaO0FBRUEsZUFBZWlJLEdBQWYiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIENvbW1hbmQgbGluZSBpbnRlcmZhY2UgZm9yIEpTZm9yY2VcbiAqIEBhdXRob3IgU2hpbmljaGkgVG9taXRhIDxzaGluaWNoaS50b21pdGFAZ21haWwuY29tPlxuICovXG5pbXBvcnQgaHR0cCBmcm9tICdodHRwJztcbmltcG9ydCB1cmwgZnJvbSAndXJsJztcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcbmltcG9ydCBvcGVuVXJsIGZyb20gJ29wZW4nO1xuaW1wb3J0IHsgQ29tbWFuZCB9IGZyb20gJ2NvbW1hbmRlcic7XG5pbXBvcnQgaW5xdWlyZXIgZnJvbSAnaW5xdWlyZXInO1xuaW1wb3J0IHJlcXVlc3QgZnJvbSAnLi4vcmVxdWVzdCc7XG5pbXBvcnQgYmFzZTY0dXJsIGZyb20gJ2Jhc2U2NHVybCc7XG5pbXBvcnQgUmVwbCBmcm9tICcuL3JlcGwnO1xuaW1wb3J0IGpzZm9yY2UsIHsgQ29ubmVjdGlvbiwgT0F1dGgyIH0gZnJvbSAnLi4nO1xuaW1wb3J0IHZlcnNpb24gZnJvbSAnLi4vVkVSU0lPTic7XG5pbXBvcnQgeyBPcHRpb25hbCB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IENsaWVudENvbmZpZyB9IGZyb20gJy4uL3JlZ2lzdHJ5L3R5cGVzJztcblxuY29uc3QgcmVnaXN0cnkgPSBqc2ZvcmNlLnJlZ2lzdHJ5O1xuXG5pbnRlcmZhY2UgQ2xpQ29tbWFuZCBleHRlbmRzIENvbW1hbmQge1xuICBjb25uZWN0aW9uPzogc3RyaW5nO1xuICB1c2VybmFtZT86IHN0cmluZztcbiAgcGFzc3dvcmQ/OiBzdHJpbmc7XG4gIGxvZ2luVXJsPzogc3RyaW5nO1xuICBzYW5kYm94PzogYm9vbGVhbjtcbiAgZXZhbFNjcmlwdD86IHN0cmluZztcbn1cblxuLyoqXG4gKlxuICovXG5leHBvcnQgY2xhc3MgQ2xpIHtcbiAgX3JlcGw6IFJlcGwgPSBuZXcgUmVwbCh0aGlzKTtcbiAgX2Nvbm46IENvbm5lY3Rpb24gPSBuZXcgQ29ubmVjdGlvbigpO1xuICBfY29ubk5hbWU6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgX291dHB1dEVuYWJsZWQ6IGJvb2xlYW4gPSB0cnVlO1xuICBfZGVmYXVsdExvZ2luVXJsOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICByZWFkQ29tbWFuZCgpOiBDbGlDb21tYW5kIHtcbiAgICByZXR1cm4gbmV3IENvbW1hbmQoKVxuICAgICAgLm9wdGlvbignLXUsIC0tdXNlcm5hbWUgW3VzZXJuYW1lXScsICdTYWxlc2ZvcmNlIHVzZXJuYW1lJylcbiAgICAgIC5vcHRpb24oXG4gICAgICAgICctcCwgLS1wYXNzd29yZCBbcGFzc3dvcmRdJyxcbiAgICAgICAgJ1NhbGVzZm9yY2UgcGFzc3dvcmQgKGFuZCBzZWN1cml0eSB0b2tlbiwgaWYgYXZhaWxhYmxlKScsXG4gICAgICApXG4gICAgICAub3B0aW9uKFxuICAgICAgICAnLWMsIC0tY29ubmVjdGlvbiBbY29ubmVjdGlvbl0nLFxuICAgICAgICAnQ29ubmVjdGlvbiBuYW1lIHN0b3JlZCBpbiBjb25uZWN0aW9uIHJlZ2lzdHJ5JyxcbiAgICAgIClcbiAgICAgIC5vcHRpb24oJy1sLCAtLWxvZ2luVXJsIFtsb2dpblVybF0nLCAnU2FsZXNmb3JjZSBsb2dpbiB1cmwnKVxuICAgICAgLm9wdGlvbignLS1zYW5kYm94JywgJ0xvZ2luIHRvIFNhbGVzZm9yY2Ugc2FuZGJveCcpXG4gICAgICAub3B0aW9uKCctZSwgLS1ldmFsU2NyaXB0IFtldmFsU2NyaXB0XScsICdTY3JpcHQgdG8gZXZhbHVhdGUnKVxuICAgICAgLnZlcnNpb24odmVyc2lvbilcbiAgICAgIC5wYXJzZShwcm9jZXNzLmFyZ3YpO1xuICB9XG5cbiAgYXN5bmMgc3RhcnQoKSB7XG4gICAgY29uc3QgcHJvZ3JhbSA9IHRoaXMucmVhZENvbW1hbmQoKTtcbiAgICB0aGlzLl9vdXRwdXRFbmFibGVkID0gIXByb2dyYW0uZXZhbFNjcmlwdDtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5jb25uZWN0KHByb2dyYW0pO1xuICAgICAgaWYgKHByb2dyYW0uZXZhbFNjcmlwdCkge1xuICAgICAgICB0aGlzLl9yZXBsLnN0YXJ0KHtcbiAgICAgICAgICBpbnRlcmFjdGl2ZTogZmFsc2UsXG4gICAgICAgICAgZXZhbFNjcmlwdDogcHJvZ3JhbS5ldmFsU2NyaXB0LFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3JlcGwuc3RhcnQoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIHByb2Nlc3MuZXhpdCgpO1xuICAgIH1cbiAgfVxuXG4gIGdldEN1cnJlbnRDb25uZWN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9jb25uO1xuICB9XG5cbiAgcHJpbnQoLi4uYXJnczogYW55W10pIHtcbiAgICBpZiAodGhpcy5fb3V0cHV0RW5hYmxlZCkge1xuICAgICAgY29uc29sZS5sb2coLi4uYXJncyk7XG4gICAgfVxuICB9XG5cbiAgc2F2ZUN1cnJlbnRDb25uZWN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9jb25uTmFtZSkge1xuICAgICAgY29uc3QgY29ubiA9IHRoaXMuX2Nvbm47XG4gICAgICBjb25zdCBjb25uTmFtZSA9IHRoaXMuX2Nvbm5OYW1lO1xuICAgICAgY29uc3QgY29ubkNvbmZpZyA9IHtcbiAgICAgICAgb2F1dGgyOiBjb25uLm9hdXRoMlxuICAgICAgICAgID8ge1xuICAgICAgICAgICAgICBjbGllbnRJZDogY29ubi5vYXV0aDIuY2xpZW50SWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICBjbGllbnRTZWNyZXQ6IGNvbm4ub2F1dGgyLmNsaWVudFNlY3JldCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIHJlZGlyZWN0VXJpOiBjb25uLm9hdXRoMi5yZWRpcmVjdFVyaSB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIGxvZ2luVXJsOiBjb25uLm9hdXRoMi5sb2dpblVybCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgIGFjY2Vzc1Rva2VuOiBjb25uLmFjY2Vzc1Rva2VuIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgaW5zdGFuY2VVcmw6IGNvbm4uaW5zdGFuY2VVcmwgfHwgdW5kZWZpbmVkLFxuICAgICAgICByZWZyZXNoVG9rZW46IGNvbm4ucmVmcmVzaFRva2VuIHx8IHVuZGVmaW5lZCxcbiAgICAgIH07XG4gICAgICByZWdpc3RyeS5zYXZlQ29ubmVjdGlvbkNvbmZpZyhjb25uTmFtZSwgY29ubkNvbmZpZyk7XG4gICAgfVxuICB9XG5cbiAgc2V0TG9naW5TZXJ2ZXIobG9naW5TZXJ2ZXI6IE9wdGlvbmFsPHN0cmluZz4pIHtcbiAgICBpZiAoIWxvZ2luU2VydmVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChsb2dpblNlcnZlciA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICB0aGlzLl9kZWZhdWx0TG9naW5VcmwgPSAnaHR0cHM6Ly9sb2dpbi5zYWxlc2ZvcmNlLmNvbSc7XG4gICAgfSBlbHNlIGlmIChsb2dpblNlcnZlciA9PT0gJ3NhbmRib3gnKSB7XG4gICAgICB0aGlzLl9kZWZhdWx0TG9naW5VcmwgPSAnaHR0cHM6Ly90ZXN0LnNhbGVzZm9yY2UuY29tJztcbiAgICB9IGVsc2UgaWYgKGxvZ2luU2VydmVyLmluZGV4T2YoJ2h0dHBzOi8vJykgIT09IDApIHtcbiAgICAgIHRoaXMuX2RlZmF1bHRMb2dpblVybCA9ICdodHRwczovLycgKyBsb2dpblNlcnZlcjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZGVmYXVsdExvZ2luVXJsID0gbG9naW5TZXJ2ZXI7XG4gICAgfVxuICAgIHRoaXMucHJpbnQoYFVzaW5nIFwiJHt0aGlzLl9kZWZhdWx0TG9naW5Vcmx9XCIgYXMgZGVmYXVsdCBsb2dpbiBVUkwuYCk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICovXG4gIGFzeW5jIGNvbm5lY3Qob3B0aW9uczoge1xuICAgIHVzZXJuYW1lPzogc3RyaW5nO1xuICAgIHBhc3N3b3JkPzogc3RyaW5nO1xuICAgIGNvbm5lY3Rpb24/OiBzdHJpbmc7XG4gICAgbG9naW5Vcmw/OiBzdHJpbmc7XG4gICAgc2FuZGJveD86IGJvb2xlYW47XG4gIH0pIHtcbiAgICBjb25zdCBsb2dpblNlcnZlciA9IG9wdGlvbnMubG9naW5VcmxcbiAgICAgID8gb3B0aW9ucy5sb2dpblVybFxuICAgICAgOiBvcHRpb25zLnNhbmRib3hcbiAgICAgID8gJ3NhbmRib3gnXG4gICAgICA6IG51bGw7XG4gICAgdGhpcy5zZXRMb2dpblNlcnZlcihsb2dpblNlcnZlcik7XG4gICAgdGhpcy5fY29ubk5hbWUgPSBvcHRpb25zLmNvbm5lY3Rpb247XG4gICAgbGV0IGNvbm5Db25maWcgPSBhd2FpdCByZWdpc3RyeS5nZXRDb25uZWN0aW9uQ29uZmlnKG9wdGlvbnMuY29ubmVjdGlvbik7XG4gICAgbGV0IHVzZXJuYW1lID0gb3B0aW9ucy51c2VybmFtZTtcbiAgICBpZiAoIWNvbm5Db25maWcpIHtcbiAgICAgIGNvbm5Db25maWcgPSB7fTtcbiAgICAgIGlmICh0aGlzLl9kZWZhdWx0TG9naW5VcmwpIHtcbiAgICAgICAgY29ubkNvbmZpZy5sb2dpblVybCA9IHRoaXMuX2RlZmF1bHRMb2dpblVybDtcbiAgICAgIH1cbiAgICAgIHVzZXJuYW1lID0gdXNlcm5hbWUgfHwgb3B0aW9ucy5jb25uZWN0aW9uO1xuICAgIH1cbiAgICB0aGlzLl9jb25uID0gbmV3IENvbm5lY3Rpb24oY29ubkNvbmZpZyk7XG4gICAgY29uc3QgcGFzc3dvcmQgPSBvcHRpb25zLnBhc3N3b3JkO1xuICAgIGlmICh1c2VybmFtZSkge1xuICAgICAgYXdhaXQgdGhpcy5zdGFydFBhc3N3b3JkQXV0aCh1c2VybmFtZSwgcGFzc3dvcmQpO1xuICAgICAgdGhpcy5zYXZlQ3VycmVudENvbm5lY3Rpb24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuX2Nvbm5OYW1lICYmIHRoaXMuX2Nvbm4uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgdGhpcy5fY29ubi5vbigncmVmcmVzaCcsICgpID0+IHtcbiAgICAgICAgICB0aGlzLnByaW50KCdSZWZyZXNoaW5nIGFjY2VzcyB0b2tlbiAuLi4gJyk7XG4gICAgICAgICAgdGhpcy5zYXZlQ3VycmVudENvbm5lY3Rpb24oKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgaWRlbnRpdHkgPSBhd2FpdCB0aGlzLl9jb25uLmlkZW50aXR5KCk7XG4gICAgICAgICAgdGhpcy5wcmludChgTG9nZ2VkIGluIGFzIDogJHtpZGVudGl0eS51c2VybmFtZX1gKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgdGhpcy5wcmludChlcnIubWVzc2FnZSk7XG4gICAgICAgICAgaWYgKHRoaXMuX2Nvbm4ub2F1dGgyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BsZWFzZSByZS1hdXRob3JpemUgY29ubmVjdGlvbi4nKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zdGFydFBhc3N3b3JkQXV0aCh0aGlzLl9jb25uTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBhc3luYyBzdGFydFBhc3N3b3JkQXV0aCh1c2VybmFtZTogc3RyaW5nLCBwYXNzd29yZD86IHN0cmluZykge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmxvZ2luQnlQYXNzd29yZCh1c2VybmFtZSwgcGFzc3dvcmQsIDIpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyci5tZXNzYWdlID09PSAnY2FuY2VsZWQnKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Bhc3N3b3JkIGF1dGhlbnRpY2F0aW9uIGNhbmNlbGVkOiBOb3QgbG9nZ2VkIGluJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBhc3luYyBsb2dpbkJ5UGFzc3dvcmQoXG4gICAgdXNlcm5hbWU6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nIHwgdW5kZWZpbmVkLFxuICAgIHJldHJ5Q291bnQ6IG51bWJlcixcbiAgKTogUHJvbWlzZTx7IGlkOiBzdHJpbmcgfT4ge1xuICAgIGlmIChwYXNzd29yZCA9PT0gJycpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY2FuY2VsZWQnKTtcbiAgICB9XG4gICAgaWYgKHBhc3N3b3JkID09IG51bGwpIHtcbiAgICAgIGNvbnN0IHBhc3MgPSBhd2FpdCB0aGlzLnByb21wdFBhc3N3b3JkKCdQYXNzd29yZDogJyk7XG4gICAgICByZXR1cm4gdGhpcy5sb2dpbkJ5UGFzc3dvcmQodXNlcm5hbWUsIHBhc3MsIHJldHJ5Q291bnQpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5fY29ubi5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpO1xuICAgICAgdGhpcy5wcmludChgTG9nZ2VkIGluIGFzIDogJHt1c2VybmFtZX1gKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKTtcbiAgICAgIGlmIChyZXRyeUNvdW50ID4gMCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2dpbkJ5UGFzc3dvcmQodXNlcm5hbWUsIHVuZGVmaW5lZCwgcmV0cnlDb3VudCAtIDEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjYW5jZWxlZCcpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgZGlzY29ubmVjdChjb25uTmFtZT86IHN0cmluZykge1xuICAgIGNvbnN0IG5hbWUgPSBjb25uTmFtZSB8fCB0aGlzLl9jb25uTmFtZTtcbiAgICBpZiAobmFtZSAmJiByZWdpc3RyeS5nZXRDb25uZWN0aW9uQ29uZmlnKG5hbWUpKSB7XG4gICAgICByZWdpc3RyeS5yZW1vdmVDb25uZWN0aW9uQ29uZmlnKG5hbWUpO1xuICAgICAgdGhpcy5wcmludChgRGlzY29ubmVjdCBjb25uZWN0aW9uICcke25hbWV9J2ApO1xuICAgIH1cbiAgICB0aGlzLl9jb25uTmFtZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLl9jb25uID0gbmV3IENvbm5lY3Rpb24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgYXV0aG9yaXplKGNsaWVudE5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IG5hbWUgPSBjbGllbnROYW1lIHx8ICdkZWZhdWx0JztcbiAgICB2YXIgb2F1dGgyQ29uZmlnID0gYXdhaXQgcmVnaXN0cnkuZ2V0Q2xpZW50Q29uZmlnKG5hbWUpO1xuICAgIGlmICghb2F1dGgyQ29uZmlnIHx8ICFvYXV0aDJDb25maWcuY2xpZW50SWQpIHtcbiAgICAgIGlmIChuYW1lID09PSAnZGVmYXVsdCcgfHwgbmFtZSA9PT0gJ3NhbmRib3gnKSB7XG4gICAgICAgIHRoaXMucHJpbnQoXG4gICAgICAgICAgJ05vIGNsaWVudCBpbmZvcm1hdGlvbiByZWdpc3RlcmVkLiBEb3dubG9hZGluZyBKU2ZvcmNlIGRlZmF1bHQgY2xpZW50IGluZm9ybWF0aW9uLi4uJyxcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG93bmxvYWREZWZhdWx0Q2xpZW50SW5mbyhuYW1lKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYE5vIE9BdXRoMiBjbGllbnQgaW5mb3JtYXRpb24gcmVnaXN0ZXJlZCA6ICcke25hbWV9Jy4gUGxlYXNlIHJlZ2lzdGVyIGNsaWVudCBpbmZvIGZpcnN0LmAsXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBvYXV0aDIgPSBuZXcgT0F1dGgyKG9hdXRoMkNvbmZpZyk7XG4gICAgY29uc3QgdmVyaWZpZXIgPSBiYXNlNjR1cmwuZW5jb2RlKGNyeXB0by5yYW5kb21CeXRlcygzMikpO1xuICAgIGNvbnN0IGNoYWxsZW5nZSA9IGJhc2U2NHVybC5lbmNvZGUoXG4gICAgICBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKHZlcmlmaWVyKS5kaWdlc3QoKSxcbiAgICApO1xuICAgIGNvbnN0IHN0YXRlID0gYmFzZTY0dXJsLmVuY29kZShjcnlwdG8ucmFuZG9tQnl0ZXMoMzIpKTtcbiAgICBjb25zdCBhdXRoelVybCA9IG9hdXRoMi5nZXRBdXRob3JpemF0aW9uVXJsKHtcbiAgICAgIGNvZGVfY2hhbGxlbmdlOiBjaGFsbGVuZ2UsXG4gICAgICBzdGF0ZSxcbiAgICB9KTtcbiAgICB0aGlzLnByaW50KCdPcGVuaW5nIGF1dGhvcml6YXRpb24gcGFnZSBpbiBicm93c2VyLi4uJyk7XG4gICAgdGhpcy5wcmludChgVVJMOiAke2F1dGh6VXJsfWApO1xuICAgIHRoaXMub3BlblVybChhdXRoelVybCk7XG4gICAgY29uc3QgcGFyYW1zID0gYXdhaXQgdGhpcy53YWl0Q2FsbGJhY2sob2F1dGgyQ29uZmlnLnJlZGlyZWN0VXJpLCBzdGF0ZSk7XG4gICAgaWYgKCFwYXJhbXMuY29kZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBhdXRob3JpemF0aW9uIGNvZGUgcmV0dXJuZWQuJyk7XG4gICAgfVxuICAgIGlmIChwYXJhbXMuc3RhdGUgIT09IHN0YXRlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgc3RhdGUgcGFyYW1ldGVyIHJldHVybmVkLicpO1xuICAgIH1cbiAgICB0aGlzLl9jb25uID0gbmV3IENvbm5lY3Rpb24oeyBvYXV0aDIgfSk7XG4gICAgdGhpcy5wcmludChcbiAgICAgICdSZWNlaXZlZCBhdXRob3JpemF0aW9uIGNvZGUuIFBsZWFzZSBjbG9zZSB0aGUgb3BlbmVkIGJyb3dzZXIgd2luZG93LicsXG4gICAgKTtcbiAgICBhd2FpdCB0aGlzLl9jb25uLmF1dGhvcml6ZShwYXJhbXMuY29kZSwgeyBjb2RlX3ZlcmlmaWVyOiB2ZXJpZmllciB9KTtcbiAgICB0aGlzLnByaW50KCdBdXRob3JpemVkLiBGZXRjaGluZyB1c2VyIGluZm8uLi4nKTtcbiAgICBjb25zdCBpZGVudGl0eSA9IGF3YWl0IHRoaXMuX2Nvbm4uaWRlbnRpdHkoKTtcbiAgICB0aGlzLnByaW50KGBMb2dnZWQgaW4gYXMgOiAke2lkZW50aXR5LnVzZXJuYW1lfWApO1xuICAgIHRoaXMuX2Nvbm5OYW1lID0gaWRlbnRpdHkudXNlcm5hbWU7XG4gICAgdGhpcy5zYXZlQ3VycmVudENvbm5lY3Rpb24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgZG93bmxvYWREZWZhdWx0Q2xpZW50SW5mbyhjbGllbnROYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb25maWdVcmwgPSAnaHR0cHM6Ly9qc2ZvcmNlLmdpdGh1Yi5pby9jbGllbnQtY29uZmlnL2RlZmF1bHQuanNvbic7XG4gICAgY29uc3QgcmVzOiB7IGJvZHk6IHN0cmluZyB9ID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgcmVxdWVzdCh7IG1ldGhvZDogJ0dFVCcsIHVybDogY29uZmlnVXJsIH0pXG4gICAgICAgIC5vbignY29tcGxldGUnLCByZXNvbHZlKVxuICAgICAgICAub24oJ2Vycm9yJywgcmVqZWN0KTtcbiAgICB9KTtcbiAgICBjb25zdCBjbGllbnRDb25maWcgPSBKU09OLnBhcnNlKHJlcy5ib2R5KTtcbiAgICBpZiAoY2xpZW50TmFtZSA9PT0gJ3NhbmRib3gnKSB7XG4gICAgICBjbGllbnRDb25maWcubG9naW5VcmwgPSAnaHR0cHM6Ly90ZXN0LnNhbGVzZm9yY2UuY29tJztcbiAgICB9XG4gICAgYXdhaXQgcmVnaXN0cnkucmVnaXN0ZXJDbGllbnRDb25maWcoY2xpZW50TmFtZSwgY2xpZW50Q29uZmlnKTtcbiAgICB0aGlzLnByaW50KCdDbGllbnQgaW5mb3JtYXRpb24gZG93bmxvYWRlZCBzdWNjZXNzZnVsbHkuJyk7XG4gICAgcmV0dXJuIHRoaXMuYXV0aG9yaXplKGNsaWVudE5hbWUpO1xuICB9XG5cbiAgYXN5bmMgd2FpdENhbGxiYWNrKFxuICAgIHNlcnZlclVybDogc3RyaW5nIHwgdW5kZWZpbmVkLFxuICAgIHN0YXRlOiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyBjb2RlOiBzdHJpbmc7IHN0YXRlOiBzdHJpbmcgfT4ge1xuICAgIGlmIChzZXJ2ZXJVcmwgJiYgc2VydmVyVXJsLmluZGV4T2YoJ2h0dHA6Ly9sb2NhbGhvc3Q6JykgPT09IDApIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHNlcnZlciA9IGh0dHAuY3JlYXRlU2VydmVyKChyZXEsIHJlcykgPT4ge1xuICAgICAgICAgIGlmICghcmVxLnVybCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBxcGFyYW1zID0gdXJsLnBhcnNlKHJlcS51cmwsIHRydWUpLnF1ZXJ5O1xuICAgICAgICAgIHJlcy53cml0ZUhlYWQoMjAwLCB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9odG1sJyB9KTtcbiAgICAgICAgICByZXMud3JpdGUoXG4gICAgICAgICAgICAnPGh0bWw+PHNjcmlwdD5sb2NhdGlvbi5ocmVmPVwiYWJvdXQ6YmxhbmtcIjs8L3NjcmlwdD48L2h0bWw+JyxcbiAgICAgICAgICApO1xuICAgICAgICAgIHJlcy5lbmQoKTtcbiAgICAgICAgICBpZiAocXBhcmFtcy5lcnJvcikge1xuICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihxcGFyYW1zLmVycm9yIGFzIHN0cmluZykpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlKHFwYXJhbXMgYXMgeyBjb2RlOiBzdHJpbmc7IHN0YXRlOiBzdHJpbmcgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNlcnZlci5jbG9zZSgpO1xuICAgICAgICAgIHJlcS5jb25uZWN0aW9uLmVuZCgpO1xuICAgICAgICAgIHJlcS5jb25uZWN0aW9uLmRlc3Ryb3koKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHBvcnQgPSBOdW1iZXIodXJsLnBhcnNlKHNlcnZlclVybCkucG9ydCk7XG4gICAgICAgIHNlcnZlci5saXN0ZW4ocG9ydCwgJ2xvY2FsaG9zdCcpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGNvZGUgPSBhd2FpdCB0aGlzLnByb21wdE1lc3NhZ2UoXG4gICAgICAgICdDb3B5ICYgcGFzdGUgYXV0aHogY29kZSBwYXNzZWQgaW4gcmVkaXJlY3RlZCBVUkw6ICcsXG4gICAgICApO1xuICAgICAgcmV0dXJuIHsgY29kZTogZGVjb2RlVVJJQ29tcG9uZW50KGNvZGUpLCBzdGF0ZSB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgcmVnaXN0ZXIoY2xpZW50TmFtZTogc3RyaW5nIHwgdW5kZWZpbmVkLCBjbGllbnRDb25maWc6IENsaWVudENvbmZpZykge1xuICAgIGNvbnN0IG5hbWUgPSBjbGllbnROYW1lIHx8ICdkZWZhdWx0JztcbiAgICBjb25zdCBwcm9tcHRzID0ge1xuICAgICAgY2xpZW50SWQ6ICdJbnB1dCBjbGllbnQgSUQgOiAnLFxuICAgICAgY2xpZW50U2VjcmV0OiAnSW5wdXQgY2xpZW50IHNlY3JldCAob3B0aW9uYWwpIDogJyxcbiAgICAgIHJlZGlyZWN0VXJpOiAnSW5wdXQgcmVkaXJlY3QgVVJJIDogJyxcbiAgICAgIGxvZ2luVXJsOiAnSW5wdXQgbG9naW4gVVJMIChkZWZhdWx0IGlzIGh0dHBzOi8vbG9naW4uc2FsZXNmb3JjZS5jb20pIDogJyxcbiAgICB9O1xuICAgIGNvbnN0IHJlZ2lzdGVyZWQgPSBhd2FpdCByZWdpc3RyeS5nZXRDbGllbnRDb25maWcobmFtZSk7XG4gICAgaWYgKHJlZ2lzdGVyZWQpIHtcbiAgICAgIGNvbnN0IG1zZyA9IGBDbGllbnQgJyR7bmFtZX0nIGlzIGFscmVhZHkgcmVnaXN0ZXJlZC4gQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIG92ZXJyaWRlID8gW3lOXSA6IGA7XG4gICAgICBjb25zdCBvayA9IGF3YWl0IHRoaXMucHJvbXB0Q29uZmlybShtc2cpO1xuICAgICAgaWYgKCFvaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZ2lzdHJhdGlvbiBjYW5jZWxlZC4nKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY2xpZW50Q29uZmlnID0gYXdhaXQgT2JqZWN0LmtleXMocHJvbXB0cykucmVkdWNlKGFzeW5jIChwcm9taXNlLCBuYW1lKSA9PiB7XG4gICAgICBjb25zdCBjY29uZmlnID0gYXdhaXQgcHJvbWlzZTtcbiAgICAgIGNvbnN0IHByb21wdE5hbWUgPSBuYW1lIGFzIGtleW9mIHR5cGVvZiBwcm9tcHRzO1xuICAgICAgY29uc3QgbWVzc2FnZSA9IHByb21wdHNbcHJvbXB0TmFtZV07XG4gICAgICBpZiAoIWNjb25maWdbcHJvbXB0TmFtZV0pIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLnByb21wdE1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5jY29uZmlnLFxuICAgICAgICAgICAgW3Byb21wdE5hbWVdOiB2YWx1ZSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gY2NvbmZpZztcbiAgICB9LCBQcm9taXNlLnJlc29sdmUoY2xpZW50Q29uZmlnKSk7XG4gICAgYXdhaXQgcmVnaXN0cnkucmVnaXN0ZXJDbGllbnRDb25maWcobmFtZSwgY2xpZW50Q29uZmlnKTtcbiAgICB0aGlzLnByaW50KCdDbGllbnQgcmVnaXN0ZXJlZCBzdWNjZXNzZnVsbHkuJyk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICovXG4gIGFzeW5jIGxpc3RDb25uZWN0aW9ucygpIHtcbiAgICBjb25zdCBuYW1lcyA9IGF3YWl0IHJlZ2lzdHJ5LmdldENvbm5lY3Rpb25OYW1lcygpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBuYW1lID0gbmFtZXNbaV07XG4gICAgICB0aGlzLnByaW50KChuYW1lID09PSB0aGlzLl9jb25uTmFtZSA/ICcqICcgOiAnICAnKSArIG5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgZ2V0Q29ubmVjdGlvbk5hbWVzKCkge1xuICAgIHJldHVybiByZWdpc3RyeS5nZXRDb25uZWN0aW9uTmFtZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgZ2V0Q2xpZW50TmFtZXMoKSB7XG4gICAgcmV0dXJuIHJlZ2lzdHJ5LmdldENsaWVudE5hbWVzKCk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICovXG4gIGFzeW5jIHByb21wdCh0eXBlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZykge1xuICAgIHRoaXMuX3JlcGwucGF1c2UoKTtcbiAgICBjb25zdCBhbnN3ZXI6IHsgdmFsdWU6IHN0cmluZyB9ID0gYXdhaXQgaW5xdWlyZXIucHJvbXB0KFtcbiAgICAgIHtcbiAgICAgICAgdHlwZSxcbiAgICAgICAgbmFtZTogJ3ZhbHVlJyxcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgIH0sXG4gICAgXSk7XG4gICAgdGhpcy5fcmVwbC5yZXN1bWUoKTtcbiAgICByZXR1cm4gYW5zd2VyLnZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBhc3luYyBwcm9tcHRNZXNzYWdlKG1lc3NhZ2U6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnByb21wdCgnaW5wdXQnLCBtZXNzYWdlKTtcbiAgfVxuXG4gIGFzeW5jIHByb21wdFBhc3N3b3JkKG1lc3NhZ2U6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnByb21wdCgncGFzc3dvcmQnLCBtZXNzYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgYXN5bmMgcHJvbXB0Q29uZmlybShtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5wcm9tcHQoJ2NvbmZpcm0nLCBtZXNzYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgb3BlblVybCh1cmw6IHN0cmluZykge1xuICAgIG9wZW5VcmwodXJsKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgb3BlblVybFVzaW5nU2Vzc2lvbih1cmw/OiBzdHJpbmcpIHtcbiAgICBsZXQgZnJvbnRkb29yVXJsID0gYCR7dGhpcy5fY29ubi5pbnN0YW5jZVVybH0vc2VjdXIvZnJvbnRkb29yLmpzcD9zaWQ9JHt0aGlzLl9jb25uLmFjY2Vzc1Rva2VufWA7XG4gICAgaWYgKHVybCkge1xuICAgICAgZnJvbnRkb29yVXJsICs9ICcmcmV0VVJMPScgKyBlbmNvZGVVUklDb21wb25lbnQodXJsKTtcbiAgICB9XG4gICAgdGhpcy5vcGVuVXJsKGZyb250ZG9vclVybCk7XG4gIH1cbn1cblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb25zdCBjbGkgPSBuZXcgQ2xpKCk7XG5cbmV4cG9ydCBkZWZhdWx0IGNsaTtcbiJdfQ==